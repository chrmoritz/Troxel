(function(){"use strict";var a;a=function(){function a(b){return b instanceof a||"object"==typeof b&&null!=b.x&&null!=b.y&&null!=b.z&&null!=b.voxels?(this.voxels=b.voxels,this.x=b.x,this.y=b.y,this.z=b.z,b.readonly&&(this.readonly=!0),!0):void 0}return a.prototype.verify=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(null==this.x||null==this.y||null==this.z||null==this.voxels)return!1;if(!(this.x>0&&this.y>0&&this.z>0&&Array.isArray(this.voxels)))return!1;if(this.voxels.length>this.z)return!1;for(g=this.voxels,a=0,d=g.length;d>a;a++){if(p=g[a],!Array.isArray(p)||p.length>this.y)return!1;for(b=0,e=p.length;e>b;b++){if(o=p[b],!Array.isArray(o)||o.length>this.x)return!1;for(c=0,f=o.length;f>c;c++){if(n=o[c],"object"!=typeof n)return!1;if(!("number"==typeof n.r&&0<=(h=n.r)&&255>=h))return!1;if(!("number"==typeof n.g&&0<=(i=n.g)&&255>=i))return!1;if(!("number"==typeof n.b&&0<=(j=n.b)&&255>=j))return!1;if(255===n.r&&0===n.g&&(n.b=255)){if("number"!=typeof n.a||250!==n.a)return!1;if("number"!=typeof n.t||7!==n.t)return!1;if("number"!=typeof n.s||7!==n.s)return!1}else{if("number"!=typeof n.a||16!==(k=n.a)&&48!==k&&80!==k&&112!==k&&144!==k&&176!==k&&208!==k&&240!==k&&255!==k)return!1;if(!("number"==typeof n.t&&0<=(l=n.t)&&4>=l))return!1;if(!("number"==typeof n.s&&0<=(m=n.s)&&4>=m))return!1}}}}return!0},a.prototype.rotateX=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(k=this.voxels.slice(0),this.voxels=[],n=b=0,e=this.z;e>b;n=b+=1)for(m=c=0,f=this.y;f>c;m=c+=1)for(l=d=0,g=this.x;g>d;l=d+=1)null!=(null!=(h=k[a?this.z-n-1:n])&&null!=(i=h[a?m:this.y-m-1])?i[l]:void 0)&&(null==this.voxels[m]&&(this.voxels[m]=[]),null==this.voxels[m][n]&&(this.voxels[m][n]=[]),this.voxels[m][n][l]=k[a?this.z-n-1:n][a?m:this.y-m-1][l]);return j=[this.y,this.z],this.z=j[0],this.y=j[1],j},a.prototype.rotateY=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(k=this.voxels.slice(0),this.voxels=[],n=b=0,e=this.z;e>b;n=b+=1)for(m=c=0,f=this.y;f>c;m=c+=1)for(l=d=0,g=this.x;g>d;l=d+=1)null!=(null!=(h=k[a?this.z-n-1:n])&&null!=(i=h[m])?i[a?l:this.x-l-1]:void 0)&&(null==this.voxels[l]&&(this.voxels[l]=[]),null==this.voxels[l][m]&&(this.voxels[l][m]=[]),this.voxels[l][m][n]=k[a?this.z-n-1:n][m][a?l:this.x-l-1]);return j=[this.x,this.z],this.z=j[0],this.x=j[1],j},a.prototype.rotateZ=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(k=this.voxels.slice(0),this.voxels=[],n=b=0,e=this.z;e>b;n=b+=1)for(m=c=0,f=this.y;f>c;m=c+=1)for(l=d=0,g=this.x;g>d;l=d+=1)null!=(null!=(h=k[n])&&null!=(i=h[a?m:this.y-m-1])?i[a?this.x-l-1:l]:void 0)&&(null==this.voxels[n]&&(this.voxels[n]=[]),null==this.voxels[n][l]&&(this.voxels[n][l]=[]),this.voxels[n][l][m]=k[n][a?m:this.y-m-1][a?this.x-l-1:l]);return j=[this.x,this.y],this.y=j[0],this.x=j[1],j},a.prototype.mirrorX=function(){var a,b,c,d,e,f,g;for(d=this.voxels.slice(0),this.voxels=[],c=[],g=a=0,b=this.z;b>a;g=a+=1)c.push(function(){var a,b,c;for(c=[],f=a=0,b=this.y;b>a;f=a+=1)c.push(function(){var a,b,c,h,i;for(i=[],e=a=0,b=this.x;b>a;e=a+=1)null!=(null!=(c=d[g])&&null!=(h=c[f])?h[this.x-e-1]:void 0)&&(null==this.voxels[g]&&(this.voxels[g]=[]),null==this.voxels[g][f]&&(this.voxels[g][f]=[]),i.push(this.voxels[g][f][e]=d[g][f][this.x-e-1]));return i}.call(this));return c}.call(this));return c},a.prototype.mirrorY=function(){var a,b,c,d,e,f,g;for(d=this.voxels.slice(0),this.voxels=[],c=[],g=a=0,b=this.z;b>a;g=a+=1)c.push(function(){var a,b,c;for(c=[],f=a=0,b=this.y;b>a;f=a+=1)c.push(function(){var a,b,c,h,i;for(i=[],e=a=0,b=this.x;b>a;e=a+=1)null!=(null!=(c=d[g])&&null!=(h=c[this.y-f-1])?h[e]:void 0)&&(null==this.voxels[g]&&(this.voxels[g]=[]),null==this.voxels[g][f]&&(this.voxels[g][f]=[]),i.push(this.voxels[g][f][e]=d[g][this.y-f-1][e]));return i}.call(this));return c}.call(this));return c},a.prototype.mirrorZ=function(){var a,b,c,d,e,f,g;for(d=this.voxels.slice(0),this.voxels=[],c=[],g=a=0,b=this.z;b>a;g=a+=1)c.push(function(){var a,b,c;for(c=[],f=a=0,b=this.y;b>a;f=a+=1)c.push(function(){var a,b,c,h,i;for(i=[],e=a=0,b=this.x;b>a;e=a+=1)null!=(null!=(c=d[this.z-g-1])&&null!=(h=c[f])?h[e]:void 0)&&(null==this.voxels[g]&&(this.voxels[g]=[]),null==this.voxels[g][f]&&(this.voxels[g][f]=[]),i.push(this.voxels[g][f][e]=d[this.z-g-1][f][e]));return i}.call(this));return c}.call(this));return c},a.prototype.moveX=function(a){var b,c,d,e,f,g,h;for(d=[],h=b=0,c=this.z;c>b;h=b+=1)null!=this.voxels[h]&&d.push(function(){var b,c,d,i,j,k,l,m;for(m=[],g=b=0,d=this.y;d>b;g=b+=1)if(null!=(null!=(i=this.voxels[h])?i[g]:void 0)){for(f=this.voxels[h][g][a?0:this.x-1],e=c=0,j=this.x-1;j>c;e=c+=1)null!=(null!=(k=this.voxels[h])&&null!=(l=k[g])?l[a?e+1:this.x-2-e]:void 0)?this.voxels[h][g][a?e:this.x-1-e]=this.voxels[h][g][a?e+1:this.x-2-e]:delete this.voxels[h][g][a?e:this.x-1-e];null!=f?m.push(this.voxels[h][g][a?this.x-1:0]=f):m.push(delete this.voxels[h][g][a?this.x-1:0])}return m}.call(this));return d},a.prototype.moveY=function(a){var b,c,d,e,f,g,h,i,j;for(g=[],j=b=0,d=this.z;d>b;j=b+=1)if(null!=this.voxels[j]){for(i=this.voxels[j][a?0:this.y-1],h=c=0,e=this.y-1;e>c;h=c+=1)null!=(null!=(f=this.voxels[j])?f[a?h+1:this.y-2-h]:void 0)?this.voxels[j][a?h:this.y-1-h]=this.voxels[j][a?h+1:this.y-2-h]:delete this.voxels[j][a?h:this.y-1-h];null!=i?g.push(this.voxels[j][a?this.y-1:0]=i):g.push(delete this.voxels[j][a?this.y-1:0])}return g},a.prototype.moveZ=function(a){var b,c,d,e;for(e=this.voxels[a?0:this.z-1],d=b=0,c=this.z-1;c>b;d=b+=1)null!=this.voxels[a?d+1:this.z-2-d]?this.voxels[a?d:this.z-1-d]=this.voxels[a?d+1:this.z-2-d]:delete this.voxels[a?d:this.z-1-d];return null!=e?this.voxels[a?this.z-1:0]=e:delete this.voxels[a?this.z-1:0]},a.prototype.resize=function(a,b,c,d,e,f){var g,h,i,j,k;for(this.x=a,this.y=b,this.z=c,f>=0?this.voxels=this.voxels.slice(f,this.z+f):(this.voxels.unshift.apply(this.voxels,Array(-f)),this.voxels=this.voxels.slice(0,this.z)),i=[],k=g=0,h=this.z;h>g;k=g+=1)null!=this.voxels[k]&&(e>=0?this.voxels[k]=this.voxels[k].slice(e,this.y+e):(this.voxels[k].unshift.apply(this.voxels[k],Array(-e)),this.voxels[k]=this.voxels[k].slice(0,this.y)),i.push(function(){var a,b,c;for(c=[],j=a=0,b=this.y;b>a;j=a+=1)null!=this.voxels[k][j]&&(d>=0?c.push(this.voxels[k][j]=this.voxels[k][j].slice(d,this.x+d)):(this.voxels[k][j].unshift.apply(this.voxels[k][j],Array(-d)),c.push(this.voxels[k][j]=this.voxels[k][j].slice(0,this.x))));return c}.call(this)));return i},a.prototype.computeBoundingBox=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(d=e=f=0,g=this.x-1,h=this.y-1,i=this.z-1,o=a=0,j=this.z;j>a;o=a+=1)if(null!=this.voxels[o])for(i=Math.min(i,o),f=Math.max(f,o),n=b=0,k=this.y;k>b;n=b+=1)if(null!=this.voxels[o][n])for(h=Math.min(h,n),e=Math.max(e,n),m=c=0,l=this.x;l>c;m=c+=1)null!=this.voxels[o][n][m]&&(g=Math.min(g,m),d=Math.max(d,m));return 0===d?[this.x,this.y,this.z,0,0,0]:[d-g+1,e-h+1,f-i+1,g,h,i]},a.prototype.getAttachmentPoint=function(){var a,b,c,d,e,f,g,h,i;for(i=a=0,d=this.z;d>a;i=a+=1)if(null!=this.voxels[i])for(h=b=0,e=this.y;e>b;h=b+=1)if(null!=this.voxels[i][h])for(g=c=0,f=this.x;f>c;g=c+=1)if(null!=this.voxels[i][h][g]&&7===this.voxels[i][h][g].t)return[g,h,i];return[0,0,0]},a.prototype.merge=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(null==b&&(b={x:0,y:0,z:0}),null!=a.x&&null!=a.y&&null!=a.z&&null!=a.voxels)for(a.readonly&&(this.readonly=!0),c&&(j=a.getAttachmentPoint(),d=j[0],e=j[1],f=j[2],b.x-=d,b.y-=e,b.z-=f),(b.x<0||b.y<0||b.z<0)&&(q=Math.min(0,b.x),r=Math.min(0,b.y),s=Math.min(0,b.z),this.resize(this.x-q,this.y-r,this.z-s,q,r,s),b.x=Math.max(0,b.x),b.y=Math.max(0,b.y),b.z=Math.max(0,b.z)),this.x=Math.max(this.x,a.x+b.x),this.y=Math.max(this.y,a.y+b.y),this.z=Math.max(this.z,a.z+b.z),v=g=k=b.z,l=this.z;l>g;v=g+=1)if(null!=a.voxels[v-b.z])for(null==this.voxels[v]&&(this.voxels[v]=[]),u=h=m=b.y,n=this.y;n>h;u=h+=1)if(null!=a.voxels[v-b.z][u-b.y])for(null==this.voxels[v][u]&&(this.voxels[v][u]=[]),t=i=o=b.x,p=this.x;p>i;t=i+=1)null!=a.voxels[v-b.z][u-b.y][t-b.x]&&(this.voxels[v][u][t]=a.voxels[v-b.z][u-b.y][t-b.x])},a}(),"object"==typeof module?module.exports=a:window.IO=a}).call(this),function(){"use strict";var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(a,b){var d;c.__super__.constructor.call(this,a)||(this.voxels=[],this.x=this.y=this.z=-1,this.warn=[],this.loadingState=0,d=new FileReader,d.onloadend=function(c){return function(){var e,f,g,h;return e=c.readFile(d.result,0),null!=a.a?(f=new FileReader,f.onloadend=function(){return c.readFile(f.result,1),2===c.loadingState++?(0===c.zOriantation&&c.mirrorZ(),b(e)):void 0},console.log("reading alpha file with name: "+a.a.name),f.readAsArrayBuffer(a.a)):c.loadingState++,null!=a.t?(h=new FileReader,h.onloadend=function(){return c.readFile(h.result,2),2===c.loadingState++?(0===c.zOriantation&&c.mirrorZ(),b(e)):void 0},console.log("reading type file with name: "+a.t.name),h.readAsArrayBuffer(a.t)):c.loadingState++,null!=a.s?(g=new FileReader,g.onloadend=function(){return c.readFile(g.result,3),2===c.loadingState++?(0===c.zOriantation&&c.mirrorZ(),b(e)):void 0},console.log("reading specular file with name: "+a.s.name),g.readAsArrayBuffer(a.s)):c.loadingState++,3===c.loadingState?(0===c.zOriantation&&c.mirrorZ(),b(e)):void 0}}(this),console.log("reading file with name: "+a.m.name),d.readAsArrayBuffer(a.m))}return b(c,a),c.prototype.readFile=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$;if(console.log("file.byteLength: "+a.byteLength),H=new Uint32Array(a.slice(0,24)),V=H[0],e=H[1],$=H[2],f=H[3],W=H[4],z=H[5],console.log("version: "+V+" (expected 257 = 1.1.0.0 = current version)"),257!==V&&console.warn("Expected version 257 but found version: "+V+" (May result in errors)"),console.log("color format: "+e+" (0 for RGBA (recommended) or 1 for BGRA)"),console.log("z-axis oriantation: "+$+" (0 for left, 1 for right handed (recommended))"),0===b&&(this.zOriantation=$),console.log("compression: "+f+" (0 for uncompressed, 1 for compressed with run length encoding (RLE))"),console.log("visability mask: "+W+" (should be 0 for encoded in A value, no partially visability)"),0!==W&&console.warn("partially visability not supported and will be ignored / handled as full visibility"),console.log("matrix count:  "+z),z>1&&console.warn("matrices will be merged into one matrix with regard to their offsets"),j=l=n=0,z>1)for(A=24,o=v=1,I=z;I>=v;o=v+=1)if(D=new Uint8Array(a.slice(A,A+1))[0],M=new Uint32Array(a.slice(A+1+D,A+13+D)),X=M[0],Y=M[1],Z=M[2],N=new Int32Array(a.slice(A+13+D,A+25+D)),i=N[0],k=N[1],m=N[2],j=Math.min(j,i),l=Math.min(l,k),n=Math.min(n,m),0===f)A+=25+D+4*X*Y*Z;else{for(p=0,h=new Uint8Array(a.slice(A+25+D)),t=w=0,O=Z;O>w;t=w+=1)for(;;){if(p+=4,6===h[p-4]&&0===h[p-3]&&0===h[p-2]&&0===h[p-1])break;2===h[p-4]&&0===h[p-3]&&0===h[p-2]&&0===h[p-1]&&(p+=8)}A+=25+D+p}for(y=24,o=x=1,P=z;P>=x;o=x+=1)if(console.log("------------------------ Matrix: "+o+" ------------------------"),D=new Uint8Array(a.slice(y,y+1))[0],C=function(){var b,c,e,f;for(e=new Uint8Array(a.slice(y+1,y+1+D)),f=[],c=0,b=e.length;b>c;c++)d=e[c],f.push(String.fromCharCode(d));return f}().join(""),console.log("reading "+o+". matrix with name: "+C),Q=new Uint32Array(a.slice(y+1+D,y+13+D)),X=Q[0],Y=Q[1],Z=Q[2],console.log("dimensions: width: "+X+" height: "+Y+" depth: "+Z),R=new Int32Array(a.slice(y+13+D,y+25+D)),i=R[0],k=R[1],m=R[2],console.log("position: dx : "+i+" dy: "+k+" dz: "+m+" (ignored if only 1 matrix)"),1===z&&(0===b&&0>=i&&0>=k&&0>=m&&(0>i||0>k||0>m)&&X>-i&&Y>-k&&Z>-m&&(c=[-i,-k,-m]),i=k=m=0),z>1&&(i-=j,k-=l,m-=n),console.log("position result: dx : "+i+" dy: "+k+" dz: "+m),0===b&&(this.x=Math.max(this.x,X+i),this.y=Math.max(this.y,Y+k),this.z=Math.max(this.z,Z+m)),0===f){for(h=new Uint8Array(a.slice(y+25+D,y+25+D+4*X*Y*Z)),t=B=0,S=Z;S>B;t=B+=1)for(s=E=0,T=Y;T>E;s=E+=1)for(r=F=0,J=X;J>F;r=F+=1)p=4*(t*Y*X+s*X+r),h[p+3]>0&&this.addValues(b,r+i,s+k,t+m,h[p],h[p+1],h[p+2],e);y+=25+D+4*X*Y*Z}else{for(h=new Uint8Array(a.slice(y+25+D)),p=0,t=G=0,K=Z;K>G;t=G+=1)for(q=0;;){if(p+=4,6===h[p-4]&&0===h[p-3]&&0===h[p-2]&&0===h[p-1])break;if(2===h[p-4]&&0===h[p-3]&&0===h[p-2]&&0===h[p-1]){if(g=h[p]+(h[p+1]<<8)+(h[p+2]<<16)+(h[p+3]<<24),h[p+7]>0)for(u=U=0,L=g;L>U;u=U+=1)r=q%X,s=Math.floor(q/X),q++,this.addValues(b,r+i,s+k,t+m,h[p+4],h[p+5],h[p+6],e);else q+=g;p+=8}else r=q%X,s=Math.floor(q/X),q++,h[p-1]>0&&this.addValues(b,r+i,s+k,t+m,h[p-4],h[p-3],h[p-2],e)}y+=25+D+p}return console.log("voxels:"),console.log(this.voxels),y!==a.byteLength&&console.warn("There shouldn't be any bytes left"),c},c.prototype.addValues=function(a,b,c,d,e,f,g,h){var i;switch(1===h&&(i=[g,e],e=i[0],g=i[1]),a){case 0:return this.addColorValues(b,c,d,e,f,g);case 1:return this.addAlphaValues(b,c,d,e,f,g);case 2:return this.addTypeValues(b,c,d,e,f,g);case 3:return this.addSpecularValues(b,c,d,e,f,g)}},c.prototype.addColorValues=function(a,b,c,d,e,f){return null==this.voxels[c]&&(this.voxels[c]=[]),null==this.voxels[c][b]&&(this.voxels[c][b]=[]),d===f&&255===f&&0===e?this.voxels[c][b][a]={r:255,g:0,b:255,a:250,t:7,s:7}:this.voxels[c][b][a]={r:d,g:e,b:f,a:255,t:0,s:0}},c.prototype.addAlphaValues=function(a,b,c,d,e,f){var g,h;return null==(null!=(g=this.voxels[c])&&null!=(h=g[b])?h[a]:void 0)?(this.warn.push("(x: "+a+", y: "+b+", z: "+c+"): Ignoring alpha voxel because of non existing color voxel at the same position"),console.warn("(x: "+a+", y: "+b+", z: "+c+"): Ignoring alpha voxel because of non existing color voxel at the same position")):d===e&&e===f?16===d||48===d||80===d||112===d||144===d||176===d||208===d||240===d||255===d?this.voxels[c][b][a].a=d:(console.warn("(x: "+a+", y: "+b+", z: "+c+"): Invalid alpha value "+d+": falling back to 122"),this.warn.push("(x: "+a+", y: "+b+", z: "+c+"): Invalid alpha value "+d+": falling back to 122"),this.voxels[c][b][a].a=112):d===f&&255===f&&0===e?this.voxels[c][b][a].a=250:(console.warn("(x: "+a+", y: "+b+", z: "+c+"): Invalid alpha value ("+d+", "+e+", "+f+"): r, g and b are not equal, falling back to 112"),this.warn.push("(x: "+a+", y: "+b+", z: "+c+"): Invalid alpha value ("+d+", "+e+", "+f+"): r, g and b are not equal, falling back to 112"),this.voxels[c][b][a].a=112)},c.prototype.addTypeValues=function(a,b,c,d,e,f){var g,h;return null==(null!=(g=this.voxels[c])&&null!=(h=g[b])?h[a]:void 0)?(this.warn.push("(x: "+a+", y: "+b+", z: "+c+"): Ignoring type voxel because of non existing color voxel at the same position"),console.warn("(x: "+a+", y: "+b+", z: "+c+"): Ignoring type voxel because of non existing color voxel at the same position")):255===d&&255===e&&255===f?this.voxels[c][b][a].t=0:128===d&&128===e&&128===f?this.voxels[c][b][a].t=1:64===d&&64===e&&64===f?this.voxels[c][b][a].t=2:255===d&&0===e&&0===f?this.voxels[c][b][a].t=3:255===d&&255===e&&0===f?this.voxels[c][b][a].t=4:255===d&&0===e&&255===f?this.voxels[c][b][a].t=7:(console.warn("(x: "+a+", y: "+b+", z: "+c+"): Invalid type value ("+d+", "+e+", "+f+"), falling back to solid"),this.warn.push("(x: "+a+", y: "+b+", z: "+c+"): Invalid type value ("+d+", "+e+", "+f+"), falling back to solid"),this.voxels[c][b][a].t=0)},c.prototype.addSpecularValues=function(a,b,c,d,e,f){var g,h;return null==(null!=(g=this.voxels[c])&&null!=(h=g[b])?h[a]:void 0)?(this.warn.push("(x: "+a+", y: "+b+", z: "+c+"): Ignoring specular voxel because of non existing color voxel at the same position"),console.warn("(x: "+a+", y: "+b+", z: "+c+"): Ignoring specular voxel because of non existing color voxel at the same position")):128===d&&0===e&&0===f?this.voxels[c][b][a].s=0:0===d&&128===e&&0===f?this.voxels[c][b][a].s=1:0===d&&0===e&&128===f?this.voxels[c][b][a].s=2:128===d&&128===e&&0===f?this.voxels[c][b][a].s=3:128===d&&0===e&&128===f?this.voxels[c][b][a].s=4:255===d&&0===e&&255===f?this.voxels[c][b][a].s=7:((d!==e||e!==f||255!==f)&&(console.warn("(x: "+a+", y: "+b+", z: "+c+"): Invalid specular value ("+d+", "+e+", "+f+"), falling back to rough"),this.warn.push("(x: "+a+", y: "+b+", z: "+c+"): Invalid specular value ("+d+", "+e+", "+f+"), falling back to rough")),this.voxels[c][b][a].s=0)},c.prototype.export=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;if(f=[1,1,0,0,0,0,0,0,1,0,0,0,+a,0,0,0,0,0,0,0,1,0,0,0,5,77,111,100,101,108],this.x<256?f.push(this.x,0,0,0):Array.prototype.push.apply(f,new Uint8Array(new Uint32Array([this.x]).buffer)),this.y<256?f.push(this.y,0,0,0):Array.prototype.push.apply(f,new Uint8Array(new Uint32Array([this.y]).buffer)),this.z<256?f.push(this.z,0,0,0):Array.prototype.push.apply(f,new Uint8Array(new Uint32Array([this.z]).buffer)),f.push(0,0,0,0,0,0,0,0,0,0,0,0),g=f.slice(0),i=f.slice(0),h=f.slice(0),k=function(a){if(null==a)return f.push(0,0,0,0),g.push(0,0,0,0),i.push(0,0,0,0),h.push(0,0,0,0);switch(f.push(a.r,a.g,a.b,255),a.a){case 250:g.push(255,0,255,255);break;case 255:g.push(255,255,255,255);break;case 240:g.push(240,240,240,255);break;case 208:g.push(208,208,208,255);break;case 176:g.push(176,176,176,255);break;case 144:g.push(144,144,144,255);break;case 112:g.push(112,112,112,255);break;case 80:g.push(80,80,80,255);break;case 48:g.push(48,48,48,255);break;case 16:g.push(16,16,16,255);break;default:g.push(112,112,112,255)}switch(a.t){case 0:i.push(255,255,255,255);break;case 1:i.push(128,128,128,255);break;case 2:i.push(64,64,64,255);break;case 3:i.push(255,0,0,255);break;case 4:i.push(255,255,0,255);break;case 7:i.push(255,0,255,255);break;default:i.push(255,255,255,255)}switch(a.s){case 0:return h.push(128,0,0,255);case 1:return h.push(0,128,0,255);case 2:return h.push(0,0,128,255);case 3:return h.push(128,128,0,255);case 4:return h.push(128,0,128,255);case 7:return h.push(255,0,255,255);default:return h.push(128,0,0,255)}},j=function(a,b){var c,d,e,f;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;for(f=["r","g","b","a","t","s"],d=0,e=f.length;e>d;d++)if(c=f[d],a[c]!==b[c])return!1;return!0},a)for(N=m=0,w=this.z;w>m;N=m+=1){if(null!=this.voxels[N]){for(K=[],o=-1,M=n=0,x=this.y;x>n;M=n+=1)for(L=q=0,A=this.x;A>q;L=q+=1)K.push(null!=(B=this.voxels[N][M])?B[L]:void 0),null!=(null!=(C=this.voxels[N][M])?C[L]:void 0)&&(o=K.length-1);for(l=0;o>=l;){for(v=1;o>=l+v&&j(K[l+v-1],K[l+v]);)v++;v>1&&(D=new Uint8Array(new Uint32Array([v]).buffer),b=D[0],c=D[1],d=D[2],e=D[3],f.push(2,0,0,0,b,c,d,e),g.push(2,0,0,0,b,c,d,e),i.push(2,0,0,0,b,c,d,e),h.push(2,0,0,0,b,c,d,e)),k(K[l]),l+=v}}f.push(6,0,0,0),g.push(6,0,0,0),i.push(6,0,0,0),h.push(6,0,0,0)}else for(N=r=0,E=this.z;E>r;N=r+=1)for(M=s=0,F=this.y;F>s;M=s+=1)for(L=t=0,G=this.x;G>t;L=t+=1)k(null!=(H=this.voxels[N])&&null!=(y=H[M])?y[L]:void 0);for(console.log("export Qubicle:"),console.log(f),z=[f,g,i,h],I=[],u=0,p=z.length;p>u;u++)J=z[u],I.push(URL.createObjectURL(new Blob([new Uint8Array(J)],{type:"application/octet-binary"})));return I},c}(IO),"object"==typeof module?module.exports=a:window.QubicleIO=a}.call(this),function(){"use strict";var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(a,b){var d;c.__super__.constructor.call(this,a)||(d=new FileReader,d.onloadend=function(a){return function(){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;if(c=d.result,p=function(){var a,b,d,f;for(d=new Uint8Array(c.slice(0,4)),f=[],a=0,b=d.length;b>a;a++)e=d[a],f.push(String.fromCharCode(e));return f}().join(""),console.log("meta: "+p+" (expected VOX )"),"VOX "!==p)throw new Error("Expected Magica Voxel header not found");if(C=new Uint32Array(c.slice(4,8))[0],console.log("version: "+C+" (expected 150)"),150!==C&&console.warn("Expected version 150 but found version: "+C+" (May result in errors)"),n=function(){var a,b,d,f;for(d=new Uint8Array(c.slice(8,12)),f=[],a=0,b=d.length;b>a;a++)e=d[a],f.push(String.fromCharCode(e));return f}().join(""),console.log("mainChunkId: "+n+" (expected MAIN)"),"MAIN"!==n)throw new Error("Didn't found main Chunk as expected");for(v=new Uint32Array(c.slice(12,20)),o=v[0],m=v[1],console.log("mainChunkSize: "+o+" (expected 0)"),console.log("mainChunkChildSize: "+m),20+m!==c.byteLength&&console.warn(console.log("There shouldn't be any bytes left")),h=20+o,A=B=E=G=r=s=-1;20+o+m>h;){switch(g=function(){var a,b,d,f;for(d=new Uint8Array(c.slice(h,h+4)),f=[],a=0,b=d.length;b>a;a++)e=d[a],f.push(String.fromCharCode(e));return f}().join(""),w=new Uint32Array(c.slice(h+4,h+12)),i=w[0],f=w[1],console.log("found child chunk: "+g+" with begin: "+(h+12)+", size: "+i+" and childSize: "+f+" (expected 0)"),g){case"SIZE":12!==i&&console.warn("invalid length of size chunk"),A=h+12,B=A+i;break;case"XYZI":E=h+12,G=E+i;break;case"RGBA":r=h+12,1024!==i&&console.warn("invalid length of palette chunk"),s=i}h+=12+i+f}if(-1===A||-1===B||-1===E||-1===G)throw new Error("missing chunks");if(x=new Uint32Array(c.slice(A,B)),a.x=x[0],a.z=x[1],a.y=x[2],console.log("dimensions: width: "+a.x+" height: "+a.y+" depth: "+a.z),q=[],-1===r||-1===s)q=[{r:255,g:255,b:255,a:255,t:0,s:0},{r:255,g:255,b:204,a:255,t:0,s:0},{r:255,g:255,b:153,a:255,t:0,s:0},{r:255,g:255,b:102,a:255,t:0,s:0},{r:255,g:255,b:51,a:255,t:0,s:0},{r:255,g:255,b:0,a:255,t:0,s:0},{r:255,g:204,b:255,a:255,t:0,s:0},{r:255,g:204,b:204,a:255,t:0,s:0},{r:255,g:204,b:153,a:255,t:0,s:0},{r:255,g:204,b:102,a:255,t:0,s:0},{r:255,g:204,b:51,a:255,t:0,s:0},{r:255,g:204,b:0,a:255,t:0,s:0},{r:255,g:153,b:255,a:255,t:0,s:0},{r:255,g:153,b:204,a:255,t:0,s:0},{r:255,g:153,b:153,a:255,t:0,s:0},{r:255,g:153,b:102,a:255,t:0,s:0},{r:255,g:153,b:51,a:255,t:0,s:0},{r:255,g:153,b:0,a:255,t:0,s:0},{r:255,g:102,b:255,a:255,t:0,s:0},{r:255,g:102,b:204,a:255,t:0,s:0},{r:255,g:102,b:153,a:255,t:0,s:0},{r:255,g:102,b:102,a:255,t:0,s:0},{r:255,g:102,b:51,a:255,t:0,s:0},{r:255,g:102,b:0,a:255,t:0,s:0},{r:255,g:51,b:255,a:255,t:0,s:0},{r:255,g:51,b:204,a:255,t:0,s:0},{r:255,g:51,b:153,a:255,t:0,s:0},{r:255,g:51,b:102,a:255,t:0,s:0},{r:255,g:51,b:51,a:255,t:0,s:0},{r:255,g:51,b:0,a:255,t:0,s:0},{r:255,g:0,b:255,a:250,t:7,s:7},{r:255,g:0,b:204,a:255,t:0,s:0},{r:255,g:0,b:153,a:255,t:0,s:0},{r:255,g:0,b:102,a:255,t:0,s:0},{r:255,g:0,b:51,a:255,t:0,s:0},{r:255,g:0,b:0,a:255,t:0,s:0},{r:204,g:255,b:255,a:255,t:0,s:0},{r:204,g:255,b:204,a:255,t:0,s:0},{r:204,g:255,b:153,a:255,t:0,s:0},{r:204,g:255,b:102,a:255,t:0,s:0},{r:204,g:255,b:51,a:255,t:0,s:0},{r:204,g:255,b:0,a:255,t:0,s:0},{r:204,g:204,b:255,a:255,t:0,s:0},{r:204,g:204,b:204,a:255,t:0,s:0},{r:204,g:204,b:153,a:255,t:0,s:0},{r:204,g:204,b:102,a:255,t:0,s:0},{r:204,g:204,b:51,a:255,t:0,s:0},{r:204,g:204,b:0,a:255,t:0,s:0},{r:204,g:153,b:255,a:255,t:0,s:0},{r:204,g:153,b:204,a:255,t:0,s:0},{r:204,g:153,b:153,a:255,t:0,s:0},{r:204,g:153,b:102,a:255,t:0,s:0},{r:204,g:153,b:51,a:255,t:0,s:0},{r:204,g:153,b:0,a:255,t:0,s:0},{r:204,g:102,b:255,a:255,t:0,s:0},{r:204,g:102,b:204,a:255,t:0,s:0},{r:204,g:102,b:153,a:255,t:0,s:0},{r:204,g:102,b:102,a:255,t:0,s:0},{r:204,g:102,b:51,a:255,t:0,s:0},{r:204,g:102,b:0,a:255,t:0,s:0},{r:204,g:51,b:255,a:255,t:0,s:0},{r:204,g:51,b:204,a:255,t:0,s:0},{r:204,g:51,b:153,a:255,t:0,s:0},{r:204,g:51,b:102,a:255,t:0,s:0},{r:204,g:51,b:51,a:255,t:0,s:0},{r:204,g:51,b:0,a:255,t:0,s:0},{r:204,g:0,b:255,a:255,t:0,s:0},{r:204,g:0,b:204,a:255,t:0,s:0},{r:204,g:0,b:153,a:255,t:0,s:0},{r:204,g:0,b:102,a:255,t:0,s:0},{r:204,g:0,b:51,a:255,t:0,s:0},{r:204,g:0,b:0,a:255,t:0,s:0},{r:153,g:255,b:255,a:255,t:0,s:0},{r:153,g:255,b:204,a:255,t:0,s:0},{r:153,g:255,b:153,a:255,t:0,s:0},{r:153,g:255,b:102,a:255,t:0,s:0},{r:153,g:255,b:51,a:255,t:0,s:0},{r:153,g:255,b:0,a:255,t:0,s:0},{r:153,g:204,b:255,a:255,t:0,s:0},{r:153,g:204,b:204,a:255,t:0,s:0},{r:153,g:204,b:153,a:255,t:0,s:0},{r:153,g:204,b:102,a:255,t:0,s:0},{r:153,g:204,b:51,a:255,t:0,s:0},{r:153,g:204,b:0,a:255,t:0,s:0},{r:153,g:153,b:255,a:255,t:0,s:0},{r:153,g:153,b:204,a:255,t:0,s:0},{r:153,g:153,b:153,a:255,t:0,s:0},{r:153,g:153,b:102,a:255,t:0,s:0},{r:153,g:153,b:51,a:255,t:0,s:0},{r:153,g:153,b:0,a:255,t:0,s:0},{r:153,g:102,b:255,a:255,t:0,s:0},{r:153,g:102,b:204,a:255,t:0,s:0},{r:153,g:102,b:153,a:255,t:0,s:0},{r:153,g:102,b:102,a:255,t:0,s:0},{r:153,g:102,b:51,a:255,t:0,s:0},{r:153,g:102,b:0,a:255,t:0,s:0},{r:153,g:51,b:255,a:255,t:0,s:0},{r:153,g:51,b:204,a:255,t:0,s:0},{r:153,g:51,b:153,a:255,t:0,s:0},{r:153,g:51,b:102,a:255,t:0,s:0},{r:153,g:51,b:51,a:255,t:0,s:0},{r:153,g:51,b:0,a:255,t:0,s:0},{r:153,g:0,b:255,a:255,t:0,s:0},{r:153,g:0,b:204,a:255,t:0,s:0},{r:153,g:0,b:153,a:255,t:0,s:0},{r:153,g:0,b:102,a:255,t:0,s:0},{r:153,g:0,b:51,a:255,t:0,s:0},{r:153,g:0,b:0,a:255,t:0,s:0},{r:102,g:255,b:255,a:255,t:0,s:0},{r:102,g:255,b:204,a:255,t:0,s:0},{r:102,g:255,b:153,a:255,t:0,s:0},{r:102,g:255,b:102,a:255,t:0,s:0},{r:102,g:255,b:51,a:255,t:0,s:0},{r:102,g:255,b:0,a:255,t:0,s:0},{r:102,g:204,b:255,a:255,t:0,s:0},{r:102,g:204,b:204,a:255,t:0,s:0},{r:102,g:204,b:153,a:255,t:0,s:0},{r:102,g:204,b:102,a:255,t:0,s:0},{r:102,g:204,b:51,a:255,t:0,s:0},{r:102,g:204,b:0,a:255,t:0,s:0},{r:102,g:153,b:255,a:255,t:0,s:0},{r:102,g:153,b:204,a:255,t:0,s:0},{r:102,g:153,b:153,a:255,t:0,s:0},{r:102,g:153,b:102,a:255,t:0,s:0},{r:102,g:153,b:51,a:255,t:0,s:0},{r:102,g:153,b:0,a:255,t:0,s:0},{r:102,g:102,b:255,a:255,t:0,s:0},{r:102,g:102,b:204,a:255,t:0,s:0},{r:102,g:102,b:153,a:255,t:0,s:0},{r:102,g:102,b:102,a:255,t:0,s:0},{r:102,g:102,b:51,a:255,t:0,s:0},{r:102,g:102,b:0,a:255,t:0,s:0},{r:102,g:51,b:255,a:255,t:0,s:0},{r:102,g:51,b:204,a:255,t:0,s:0},{r:102,g:51,b:153,a:255,t:0,s:0},{r:102,g:51,b:102,a:255,t:0,s:0},{r:102,g:51,b:51,a:255,t:0,s:0},{r:102,g:51,b:0,a:255,t:0,s:0},{r:102,g:0,b:255,a:255,t:0,s:0},{r:102,g:0,b:204,a:255,t:0,s:0},{r:102,g:0,b:153,a:255,t:0,s:0},{r:102,g:0,b:102,a:255,t:0,s:0},{r:102,g:0,b:51,a:255,t:0,s:0},{r:102,g:0,b:0,a:255,t:0,s:0},{r:51,g:255,b:255,a:255,t:0,s:0},{r:51,g:255,b:204,a:255,t:0,s:0},{r:51,g:255,b:153,a:255,t:0,s:0},{r:51,g:255,b:102,a:255,t:0,s:0},{r:51,g:255,b:51,a:255,t:0,s:0},{r:51,g:255,b:0,a:255,t:0,s:0},{r:51,g:204,b:255,a:255,t:0,s:0},{r:51,g:204,b:204,a:255,t:0,s:0},{r:51,g:204,b:153,a:255,t:0,s:0},{r:51,g:204,b:102,a:255,t:0,s:0},{r:51,g:204,b:51,a:255,t:0,s:0},{r:51,g:204,b:0,a:255,t:0,s:0},{r:51,g:153,b:255,a:255,t:0,s:0},{r:51,g:153,b:204,a:255,t:0,s:0},{r:51,g:153,b:153,a:255,t:0,s:0},{r:51,g:153,b:102,a:255,t:0,s:0},{r:51,g:153,b:51,a:255,t:0,s:0},{r:51,g:153,b:0,a:255,t:0,s:0},{r:51,g:102,b:255,a:255,t:0,s:0},{r:51,g:102,b:204,a:255,t:0,s:0},{r:51,g:102,b:153,a:255,t:0,s:0},{r:51,g:102,b:102,a:255,t:0,s:0},{r:51,g:102,b:51,a:255,t:0,s:0},{r:51,g:102,b:0,a:255,t:0,s:0},{r:51,g:51,b:255,a:255,t:0,s:0},{r:51,g:51,b:204,a:255,t:0,s:0},{r:51,g:51,b:153,a:255,t:0,s:0},{r:51,g:51,b:102,a:255,t:0,s:0},{r:51,g:51,b:51,a:255,t:0,s:0},{r:51,g:51,b:0,a:255,t:0,s:0},{r:51,g:0,b:255,a:255,t:0,s:0},{r:51,g:0,b:204,a:255,t:0,s:0},{r:51,g:0,b:153,a:255,t:0,s:0},{r:51,g:0,b:102,a:255,t:0,s:0},{r:51,g:0,b:51,a:255,t:0,s:0},{r:51,g:0,b:0,a:255,t:0,s:0},{r:0,g:255,b:255,a:255,t:0,s:0},{r:0,g:255,b:204,a:255,t:0,s:0},{r:0,g:255,b:153,a:255,t:0,s:0},{r:0,g:255,b:102,a:255,t:0,s:0},{r:0,g:255,b:51,a:255,t:0,s:0},{r:0,g:255,b:0,a:255,t:0,s:0},{r:0,g:204,b:255,a:255,t:0,s:0},{r:0,g:204,b:204,a:255,t:0,s:0},{r:0,g:204,b:153,a:255,t:0,s:0},{r:0,g:204,b:102,a:255,t:0,s:0},{r:0,g:204,b:51,a:255,t:0,s:0},{r:0,g:204,b:0,a:255,t:0,s:0},{r:0,g:153,b:255,a:255,t:0,s:0},{r:0,g:153,b:204,a:255,t:0,s:0},{r:0,g:153,b:153,a:255,t:0,s:0},{r:0,g:153,b:102,a:255,t:0,s:0},{r:0,g:153,b:51,a:255,t:0,s:0},{r:0,g:153,b:0,a:255,t:0,s:0},{r:0,g:102,b:255,a:255,t:0,s:0},{r:0,g:102,b:204,a:255,t:0,s:0},{r:0,g:102,b:153,a:255,t:0,s:0},{r:0,g:102,b:102,a:255,t:0,s:0},{r:0,g:102,b:51,a:255,t:0,s:0},{r:0,g:102,b:0,a:255,t:0,s:0},{r:0,g:51,b:255,a:255,t:0,s:0},{r:0,g:51,b:204,a:255,t:0,s:0},{r:0,g:51,b:153,a:255,t:0,s:0},{r:0,g:51,b:102,a:255,t:0,s:0},{r:0,g:51,b:51,a:255,t:0,s:0},{r:0,g:51,b:0,a:255,t:0,s:0},{r:0,g:0,b:255,a:255,t:0,s:0},{r:0,g:0,b:204,a:255,t:0,s:0},{r:0,g:0,b:153,a:255,t:0,s:0},{r:0,g:0,b:102,a:255,t:0,s:0},{r:0,g:0,b:51,a:255,t:0,s:0},{r:238,g:0,b:0,a:255,t:0,s:0},{r:221,g:0,b:0,a:255,t:0,s:0},{r:187,g:0,b:0,a:255,t:0,s:0},{r:170,g:0,b:0,a:255,t:0,s:0},{r:136,g:0,b:0,a:255,t:0,s:0},{r:119,g:0,b:0,a:255,t:0,s:0},{r:85,g:0,b:0,a:255,t:0,s:0},{r:68,g:0,b:0,a:255,t:0,s:0},{r:34,g:0,b:0,a:255,t:0,s:0},{r:17,g:0,b:0,a:255,t:0,s:0},{r:0,g:238,b:0,a:255,t:0,s:0},{r:0,g:221,b:0,a:255,t:0,s:0},{r:0,g:187,b:0,a:255,t:0,s:0},{r:0,g:170,b:0,a:255,t:0,s:0},{r:0,g:136,b:0,a:255,t:0,s:0},{r:0,g:119,b:0,a:255,t:0,s:0},{r:0,g:85,b:0,a:255,t:0,s:0},{r:0,g:68,b:0,a:255,t:0,s:0},{r:0,g:34,b:0,a:255,t:0,s:0},{r:0,g:17,b:0,a:255,t:0,s:0},{r:0,g:0,b:238,a:255,t:0,s:0},{r:0,g:0,b:221,a:255,t:0,s:0},{r:0,g:0,b:187,a:255,t:0,s:0},{r:0,g:0,b:170,a:255,t:0,s:0},{r:0,g:0,b:136,a:255,t:0,s:0},{r:0,g:0,b:119,a:255,t:0,s:0},{r:0,g:0,b:85,a:255,t:0,s:0},{r:0,g:0,b:68,a:255,t:0,s:0},{r:0,g:0,b:34,a:255,t:0,s:0},{r:0,g:0,b:17,a:255,t:0,s:0},{r:238,g:238,b:238,a:255,t:0,s:0},{r:221,g:221,b:221,a:255,t:0,s:0},{r:187,g:187,b:187,a:255,t:0,s:0},{r:170,g:170,b:170,a:255,t:0,s:0},{r:136,g:136,b:136,a:255,t:0,s:0},{r:119,g:119,b:119,a:255,t:0,s:0},{r:85,g:85,b:85,a:255,t:0,s:0},{r:68,g:68,b:68,a:255,t:0,s:0},{r:34,g:34,b:34,a:255,t:0,s:0},{r:17,g:17,b:17,a:255,t:0,s:0}],console.log("default palette");else{for(t=new Uint8Array(c.slice(r,r+s)),j=k=0,y=s;y>k;j=k+=4)255===t[j]&&0===t[j+1]&&255===t[j+2]?q.push({r:255,g:0,b:255,a:250,t:7,s:7}):q.push({r:t[j],g:t[j+1],b:t[j+2],a:255,t:0,s:0});console.log("palette:"),console.log(q)}for(a.voxels=[],F=new Uint32Array(c.slice(E,E+4))[0],console.log("voxel count: "+F),E+4+4*F!==G&&console.warn("invalid length of voxel chunk"),u=new Uint8Array(c.slice(E+4,E+4+4*F)),j=l=0,z=4*F;z>l;j=l+=4)H=a.z-u[j+1]-1,null==a.voxels[H]&&(a.voxels[H]=[]),null==a.voxels[H][u[j+2]]&&(a.voxels[H][u[j+2]]=[]),D=q[u[j+3]-1],a.voxels[H][u[j+2]][a.x-u[j]-1]={r:D.r,g:D.g,b:D.b,a:D.a,s:D.s,t:D.t};return console.log("voxels:"),console.log(a.voxels),b()}}(this),console.log("reading file with name: "+a.name),d.readAsArrayBuffer(a))}return b(c,a),c.prototype.export=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S;for(e=[86,79,88,32,150,0,0,0,77,65,73,78,0,0,0,0],m=new Uint8Array(new Uint32Array([this.x]).buffer),F=m[0],G=m[1],H=m[2],I=m[3],n=new Uint8Array(new Uint32Array([this.z]).buffer),K=n[0],L=n[1],M=n[2],N=n[3],p=new Uint8Array(new Uint32Array([this.y]).buffer),P=p[0],Q=p[1],R=p[2],S=p[3],C=[83,73,90,69,12,0,0,0,0,0,0,0,F,G,H,I,K,L,M,N,P,Q,R,S],D=[],l=[82,71,66,65,0,4,0,0,0,0,0,0],f={},O=i=0,q=this.z;q>i;O=i+=1)for(h=this.z-O-1,J=j=0,r=this.y;r>j;J=j+=1)for(E=k=0,s=this.x;s>k;E=k+=1)if(null!=(null!=(t=this.voxels[O])&&null!=(u=t[J])?u[E]:void 0)){if(x=(this.voxels[O][J][E].r<<24|this.voxels[O][J][E].g<<16|this.voxels[O][J][E].b<<8|255)>>>0,g=f[x],null==g){if(!(l.length<1036))throw new Error("To many colors for Magica Voxel palette");l.push(this.voxels[O][J][E].r,this.voxels[O][J][E].g,this.voxels[O][J][E].b,255),g=l.length/4-3,f[x]=g}D.push(this.x-E-1,h,J,g)}for(;l.length<1036;)l.push(255,255,255,255);return v=new Uint8Array(new Uint32Array([1076+D.length]).buffer),y=v[0],z=v[1],A=v[2],B=v[3],e.push(y,z,A,B),e=e.concat(C),w=new Uint8Array(new Uint32Array([D.length+4]).buffer),y=w[0],z=w[1],A=w[2],B=w[3],o=new Uint8Array(new Uint32Array([D.length/4]).buffer),a=o[0],b=o[1],c=o[2],d=o[3],e.push(88,89,90,73,y,z,A,B,0,0,0,0,a,b,c,d),e=e.concat(D),e=e.concat(l),console.log("export Magica:"),console.log(e),URL.createObjectURL(new Blob([new Uint8Array(e)],{type:"application/octet-binary"}))},c}(IO),"object"==typeof module?module.exports=a:window.MagicaIO=a}.call(this),function(){"use strict";var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(a,b){var d;c.__super__.constructor.call(this,a)||(this.voxels=[],
d=new FileReader,d.onloadend=function(a){return function(){var c,e,f,g,h,i,j,k,l,m,n,o,p,q;for(e=JSON.parse(d.result),c=e.creator,a.x=e.width,a.y=e.height,a.z=e.depth,n=e.version,g=e.frames,console.log("creator: "+o),console.log("version: "+n+" (expected 1)"),console.log("frames: "+g+" (expected 1)"),console.log("dimensions: width : "+a.x+" height: "+a.y+" depth: "+a.z),console.log("frame data:"),f=h=1,k=g;k>=h;f=h+=1)for(console.log(e["frame"+f]),l=e["frame"+f],i=0,j=l.length;j>i;i++)m=l[i],o=m[0],p=m[1],q=m[2],c=m[3],q=a.z-q-1,o=a.x-o-1,null==a.voxels[q]&&(a.voxels[q]=[]),null==a.voxels[q][p]&&(a.voxels[q][p]=[]),a.voxels[q][p][o]={r:(4278190080&c)>>>24,g:(16711680&c)>>>16,b:(65280&c)>>>8,a:255,t:0,s:0},255===a.voxels[q][p][o].r&&0===a.voxels[q][p][o].g&&255===a.voxels[q][p][o].b&&(a.voxels[q][p][o]={r:255,g:0,b:255,a:250,t:7,s:7});return console.log("voxels:"),console.log(a.voxels),b()}}(this),console.log("reading file with name: "+a.name),d.readAsText(a))}return b(c,a),c.prototype.export=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(a=[],l=this.voxels,e=b=0,i=l.length;i>b;e=++b)if(o=l[e],null!=o)for(d=f=0,j=o.length;j>f;d=++f)if(n=o[d],null!=n)for(c=h=0,k=n.length;k>h;c=++h)m=n[c],null!=m&&a.push([this.x-c-1,d,this.z-e-1,(m.r<<24|m.g<<16|m.b<<8|255)>>>0]);return g={creator:"Troxel",width:this.x,height:this.y,depth:this.z,version:1,frames:1,frame1:a},console.log("Zoxel export:"),console.log(g),"data:application/octet-binary;base64,"+btoa(JSON.stringify(g))},c}(IO),"object"==typeof module?module.exports=a:window.ZoxelIO=a}.call(this),function(){"use strict";var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty,e=[].slice;a=function(a){function b(a){var c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;if(!b.__super__.constructor.call(this,a)){if(this.voxels=[],d=atob(a).split("").map(function(a){return a.charCodeAt(0)}),0===d[0]?(c=d[0],D=d[1],E=d[2],F=d[3],G=d[4],I=d[5],J=d[6],K=d[7],L=d[8],N=d[9],O=d[10],P=d[11],Q=d[12],this.readonly=d[13],f=15<=d.length?e.call(d,14):[],this.x=new Uint32Array(new Uint8Array([D,E,F,G]).buffer)[0],this.y=new Uint32Array(new Uint8Array([I,J,K,L]).buffer)[0],this.z=new Uint32Array(new Uint8Array([N,O,P,Q]).buffer)[0]):(this.x=d[0],this.y=d[1],this.z=d[2],this.readonly=d[3],f=5<=d.length?e.call(d,4):[]),g=s=0,B={},85===f[0]){for(q=256*f[1]+f[2],A=0===f[1]&&f[2]<128?1:2,p=[null],i=j=3,t=5*q+3;t>j;i=j+=5)p.push({r:f[i+1],g:f[i+2],b:f[i+3],a:f[i+4],s:f[i]%16,t:f[i]>>4});for(g=5*q+3,M=k=0,u=this.z;u>k;M=k+=1)for(H=l=0,v=this.y;v>l;H=l+=1)for(C=m=0,w=this.x;w>m;C=m+=1)0===s&&(f[g]>127?(s=f[g]-126,g++):s=1,h=1===A?f[g]:256*f[g]+f[g+1],B=0!==h?p[h]:null,g+=A),null!=B&&(null==this.voxels[M]&&(this.voxels[M]=[]),null==this.voxels[M][H]&&(this.voxels[M][H]=[]),this.voxels[M][H][C]={r:B.r,g:B.g,b:B.b,a:B.a,s:B.s,t:B.t}),s--}else for(M=n=0,x=this.z;x>n;M=n+=1)for(H=o=0,y=this.y;y>o;H=o+=1)for(C=r=0,z=this.x;z>r;C=r+=1){if(0===s){if(f[g]>127?(s=f[g]-127,g++):s=1,f[g]>127)throw new Error("Base64 parsing error");f[g]<64?(B={r:f[g+1],g:f[g+2],b:f[g+3],a:f[g+4],s:f[g]%8,t:f[g]>>3},g+=5):(B=null,g++)}null!=B&&(null==this.voxels[M]&&(this.voxels[M]=[]),null==this.voxels[M][H]&&(this.voxels[M][H]=[]),this.voxels[M][H][C]={r:B.r,g:B.g,b:B.b,a:B.a,s:B.s,t:B.t}),s--}g!==f.length&&console.warn("There shouldn't be any bytes left"),this.readonly||console.log("voxels:"),this.readonly||console.log(this.voxels)}}return c(b,a),b.prototype.export=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P;for(null==b&&(b=1),this.readonly&&(a=!0),d=function(a,b,c){var d,e,f,g;if(!(c<A.length))return!1;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;for(g=["r","g","b","a","t","s"],e=0,f=g.length;f>e;e++)if(d=g[e],a[d]!==b[d])return!1;return!0},this.x>255||this.y>255||this.z>255?(p=new Uint8Array(new Uint32Array([this.x]).buffer),C=p[0],D=p[1],E=p[2],F=p[3],q=new Uint8Array(new Uint32Array([this.y]).buffer),H=q[0],I=q[1],J=q[2],K=q[3],r=new Uint8Array(new Uint32Array([this.z]).buffer),M=r[0],N=r[1],O=r[2],P=r[3],c=[0,C,D,E,F,H,I,J,K,M,N,O,P,a?1:0]):c=[this.x,this.y,this.z,a?1:0],A=[],L=h=0,s=this.z;s>h;L=h+=1)for(G=i=0,t=this.y;t>i;G=i+=1)for(B=k=0,u=this.x;u>k;B=k+=1)A.push(null!=(v=this.voxels[L])&&null!=(w=v[G])?w[B]:void 0);if(f=0,1===b)for(;f<A.length;){for(n=1;128>n&&d(A[f+n-1],A[f+n],f+n);)n++;n>1&&c.push(127+n),null!=A[f]?c.push(8*A[f].t+A[f].s,A[f].r,A[f].g,A[f].b,A[f].a):c.push(64),f+=n}if(2===b){for(c.push(85,0,0),o=[],m=0,j=A.length;j>m;m++)if(z=A[m],null!=z&&(e=z.b+256*z.g+65536*z.r,l=z.a+256*z.t+2048*z.s,null==o[e]&&(o[e]=[]),null==(null!=(x=o[e])?x[l]:void 0)&&(c.push(16*z.t+z.s,z.r,z.g,z.b,z.a),o[e][l]=(c.length-7)/5,!((c.length-7)/5<32768))))throw new Error("To many colors for Troxel2 palette");for(c[5]=Math.floor((c.length-7)/1280),c[6]=(c.length-7)/5%256,y=0===c[5]&&c[6]<128;f<A.length;){for(n=1;129>n&&d(A[f+n-1],A[f+n],f+n);)n++;n>1&&c.push(126+n),null!=A[f]?(g=o[A[f].b+256*A[f].g+65536*A[f].r][A[f].a+256*A[f].t+2048*A[f].s],y?c.push(g):c.push(Math.floor(g/256),g%256)):y?c.push(0):c.push(0,0),f+=n}}return console.log("export base64:"),console.log(c),btoa(String.fromCharCode.apply(null,c))},b}(IO),b=function(a){function b(a){var c;b.__super__.constructor.call(this,a)||(c=JSON.parse(a),this.x=c.x,this.y=c.y,this.z=c.z,this.voxels=c.voxels)}return c(b,a),b.prototype.export=function(a){return JSON.stringify({x:this.x,y:this.y,z:this.z,voxels:this.voxels},null,a?"    ":"")},b}(IO),("undefined"!=typeof exports&&null!==exports?exports:window).Base64IO=a,("undefined"!=typeof exports&&null!==exports?exports:window).JsonIO=b}.call(this),function(){"use strict";var a;a=function(){function a(a,b,c,d,e,f,g,h){var i,j;this.embedded=null!=b?b:!1,this.domContainer=null!=c?c:$("#WebGlContainer"),this.renderMode=null!=d?d:0,this.renderWireframes=null!=e?e:0,null==f&&(f=!0),this.ssao=null!=g?g:!1,null==h&&(h=!0),this.width=this.domContainer.width(),this.height=this.domContainer.height(),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,1,1e5),this.controls=new THREE.TroxelControls(this.camera,this.domContainer[0]),this.controls.mode=h,this.controls.addEventListener("change",function(a){return function(){return a.render()}}(this)),this.reload(a.voxels,a.x,a.y,a.z,!1,!0),this.ambientLight=new THREE.AmbientLight(6316128),this.scene.add(this.ambientLight),this.directionalLight=new THREE.DirectionalLight(16777215,.3),this.directionalLight.position.set(-.5,-.5,1).normalize(),this.scene.add(this.directionalLight),this.pointLight=new THREE.PointLight(16777215,.6,1e5),this.camera.add(this.pointLight),this.scene.add(this.camera),this.renderer=new THREE.WebGLRenderer({antialias:f}),this.renderer.setClearColor(8947848),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.domContainer.empty().append(this.renderer.domElement),this.ssao&&(this.composer=new THREE.EffectComposer(this.renderer),this.composer.addPass(new THREE.RenderPass(this.scene,this.camera)),this.ssaoPass=new THREE.ShaderPass(THREE.SSAOShader),this.depthRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter}),this.ssaoPass.uniforms.tDepth.value=this.depthRenderTarget,this.ssaoPass.uniforms.size.value.set(this.width,this.height),this.ssaoPass.uniforms.cameraNear.value=this.camera.near,this.ssaoPass.uniforms.cameraFar.value=this.camera.far,this.ssaoPass.uniforms.onlyAO.value=!1,this.ssaoPass.uniforms.aoClamp.value=.5,this.ssaoPass.uniforms.lumInfluence.value=.25,this.composer.addPass(this.ssaoPass),this.fxaaPass=new THREE.ShaderPass(THREE.FXAAShader),this.fxaaPass.uniforms.resolution.value.set(1/this.width,1/this.height),this.fxaaPass.renderToScreen=!0,this.composer.addPass(this.fxaaPass),i=THREE.ShaderLib.depthRGBA,j=THREE.UniformsUtils.clone(i.uniforms),this.depthMaterial=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j,blending:THREE.NoBlending})),window.addEventListener("resize",function(a){return function(b){return a.onWindowResize(b)}}(this)),this.embedded&&this.animate()}return a.prototype.getMaterial=function(a,b,c,d){var e;switch(this.renderMode){case 0:case 1:break;case 2:a={250:16711935,16:1052688,48:3158064,80:5263440,12:7368816,144:9474192,176:11579568,208:13684944,240:15790320,255:16777215}[b];break;case 3:a=[16777215,8421504,4210752,16711680,16776960,null,null,16711935][c];break;case 4:a=[8388608,32768,128,8421376,8388736,null,null,16711935][d]}return e=new THREE.MeshPhongMaterial({color:a,ambient:a}),0===this.renderMode?((3===c||4===c)&&(e.emissive=e.color.multiplyScalar(.5)),1===d&&(e.specular=e.color.multiplyScalar(.5)),(1===c||2===c||4===c)&&(e.transparent=!0,e.opacity=b/255)):e.shininess=.1,e},a.prototype.reload=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta;for(this.voxels=a,this.x=b,this.y=c,this.z=d,null==e&&(e=!1),null==f&&(f=!1),(e||f)&&(this.embedded?(g=Math.max(this.x,this.z),this.camera.position.x=85*g+65*this.y,this.camera.position.y=50*this.y,this.camera.position.z=25*g):(this.camera.position.x=65*this.y+35*this.x+55*this.z,this.camera.position.y=50*this.y,this.camera.position.z=25*this.x),this.controls.target=new THREE.Vector3(25*this.z,25*this.y,25*this.x)),f||(this.scene.remove(this.mesh),this.mesh.geometry.dispose(),null!=this.wireframe&&(this.scene.remove(this.wireframe),this.wireframe.geometry.dispose())),r=new THREE.Matrix4,h=new THREE.Color,v=new THREE.PlaneGeometry(50,50),v.applyMatrix(r.makeRotationY(Math.PI/2)),v.applyMatrix(r.makeTranslation(25,0,0)),s=new THREE.PlaneGeometry(50,50),s.applyMatrix(r.makeRotationY(-Math.PI/2)),s.applyMatrix(r.makeTranslation(-25,0,0)),w=new THREE.PlaneGeometry(50,50),w.applyMatrix(r.makeRotationX(-Math.PI/2)),w.applyMatrix(r.makeTranslation(0,25,0)),t=new THREE.PlaneGeometry(50,50),t.applyMatrix(r.makeRotationX(Math.PI/2)),t.applyMatrix(r.makeTranslation(0,-25,0)),x=new THREE.PlaneGeometry(50,50),x.applyMatrix(r.makeTranslation(0,0,25)),u=new THREE.PlaneGeometry(50,50),u.applyMatrix(r.makeRotationY(Math.PI)),u.applyMatrix(r.makeTranslation(0,0,-25)),i=new THREE.Geometry,q=[],na=[],this.wireframe=null,this.renderWireframes>0&&(qa=new THREE.Geometry),ta=k=0,y=this.z;y>k;ta=k+=1)if(null!=this.voxels[ta])for(sa=l=0,z=this.y;z>l;sa=l+=1)if(null!=(null!=(K=this.voxels[ta])?K[sa]:void 0))for(ra=m=0,V=this.x;V>m;ra=m+=1)null!=(null!=(ea=this.voxels[ta])&&null!=(ia=ea[sa])?ia[ra]:void 0)&&(oa=this.voxels[ta][sa][ra],h.setRGB(oa.r/255,oa.g/255,oa.b/255),j=h.getHex(),o=oa.a+256*oa.t+2048*oa.s,null!=(null!=(ja=na[j])?ja[o]:void 0)?p=na[j][o]:(p=q.length,null==na[j]&&(na[j]=[]),na[j][o]=p,q.push(this.getMaterial(h,oa.a,oa.t,oa.s))),r.makeTranslation(50*ta+25,50*sa+25,50*ra+25),(null==(null!=(ka=this.voxels[ta+1])&&null!=(la=ka[sa])?la[ra]:void 0)||(1===(ma=this.voxels[ta+1][sa][ra].t)||2===ma||4===ma)&&1!==(A=oa.t)&&2!==A&&4!==A)&&i.merge(v,r,p),(null==(null!=(B=this.voxels[ta-1])&&null!=(C=B[sa])?C[ra]:void 0)||(1===(D=this.voxels[ta-1][sa][ra].t)||2===D||4===D)&&1!==(E=oa.t)&&2!==E&&4!==E)&&i.merge(s,r,p),(null==(null!=(F=this.voxels[ta])&&null!=(G=F[sa+1])?G[ra]:void 0)||(1===(H=this.voxels[ta][sa+1][ra].t)||2===H||4===H)&&1!==(I=oa.t)&&2!==I&&4!==I)&&i.merge(w,r,p),(null==(null!=(J=this.voxels[ta])&&null!=(L=J[sa-1])?L[ra]:void 0)||(1===(M=this.voxels[ta][sa-1][ra].t)||2===M||4===M)&&1!==(N=oa.t)&&2!==N&&4!==N)&&i.merge(t,r,p),(null==(null!=(O=this.voxels[ta])&&null!=(P=O[sa])?P[ra+1]:void 0)||(1===(Q=this.voxels[ta][sa][ra+1].t)||2===Q||4===Q)&&1!==(R=oa.t)&&2!==R&&4!==R)&&i.merge(x,r,p),(null==(null!=(S=this.voxels[ta])&&null!=(T=S[sa])?T[ra-1]:void 0)||(1===(U=this.voxels[ta][sa][ra-1].t)||2===U||4===U)&&1!==(W=oa.t)&&2!==W&&4!==W)&&i.merge(u,r,p),this.renderWireframes>0&&(pa=function(){switch(this.renderWireframes){case 2:return new THREE.Color(oa.r/255,oa.g/255,oa.b/255);case 3:return new THREE.Color({250:16711935,16:1052688,48:3158064,80:5263440,12:7368816,144:9474192,176:11579568,208:13684944,240:15790320,255:16777215}[oa.a]);case 4:return new THREE.Color([16777215,8421504,4210752,16711680,16776960,null,null,16711935][oa.t]);case 5:return new THREE.Color([8388608,32768,128,8421376,8388736,null,null,16711935][oa.s]);case 6:return null!=oa.linter?new THREE.Color(oa.linter):!1;default:return new THREE.Color(3355443)}}.call(this),null==(null!=(X=this.voxels[ta+1])&&null!=(Y=X[sa])?Y[ra]:void 0)&&pa&&(qa.vertices.push(new THREE.Vector3(50*ta+50,50*sa,50*ra),new THREE.Vector3(50*ta+50,50*sa,50*ra+50),new THREE.Vector3(50*ta+50,50*sa,50*ra+50),new THREE.Vector3(50*ta+50,50*sa+50,50*ra+50),new THREE.Vector3(50*ta+50,50*sa+50,50*ra+50),new THREE.Vector3(50*ta+50,50*sa+50,50*ra),new THREE.Vector3(50*ta+50,50*sa+50,50*ra),new THREE.Vector3(50*ta+50,50*sa,50*ra)),qa.colors.push(pa,pa,pa,pa,pa,pa,pa,pa)),null==(null!=(Z=this.voxels[ta-1])&&null!=($=Z[sa])?$[ra]:void 0)&&pa&&(qa.vertices.push(new THREE.Vector3(50*ta,50*sa,50*ra),new THREE.Vector3(50*ta,50*sa,50*ra+50),new THREE.Vector3(50*ta,50*sa,50*ra+50),new THREE.Vector3(50*ta,50*sa+50,50*ra+50),new THREE.Vector3(50*ta,50*sa+50,50*ra+50),new THREE.Vector3(50*ta,50*sa+50,50*ra),new THREE.Vector3(50*ta,50*sa+50,50*ra),new THREE.Vector3(50*ta,50*sa,50*ra)),qa.colors.push(pa,pa,pa,pa,pa,pa,pa,pa)),null==(null!=(_=this.voxels[ta])&&null!=(aa=_[sa+1])?aa[ra]:void 0)&&pa&&(qa.vertices.push(new THREE.Vector3(50*ta,50*sa+50,50*ra),new THREE.Vector3(50*ta,50*sa+50,50*ra+50),new THREE.Vector3(50*ta,50*sa+50,50*ra+50),new THREE.Vector3(50*ta+50,50*sa+50,50*ra+50),new THREE.Vector3(50*ta+50,50*sa+50,50*ra+50),new THREE.Vector3(50*ta+50,50*sa+50,50*ra),new THREE.Vector3(50*ta+50,50*sa+50,50*ra),new THREE.Vector3(50*ta,50*sa+50,50*ra)),qa.colors.push(pa,pa,pa,pa,pa,pa,pa,pa)),null==(null!=(ba=this.voxels[ta])&&null!=(ca=ba[sa-1])?ca[ra]:void 0)&&pa&&(qa.vertices.push(new THREE.Vector3(50*ta,50*sa,50*ra),new THREE.Vector3(50*ta,50*sa,50*ra+50),new THREE.Vector3(50*ta,50*sa,50*ra+50),new THREE.Vector3(50*ta+50,50*sa,50*ra+50),new THREE.Vector3(50*ta+50,50*sa,50*ra+50),new THREE.Vector3(50*ta+50,50*sa,50*ra),new THREE.Vector3(50*ta+50,50*sa,50*ra),new THREE.Vector3(50*ta,50*sa,50*ra)),qa.colors.push(pa,pa,pa,pa,pa,pa,pa,pa)),null==(null!=(da=this.voxels[ta])&&null!=(fa=da[sa])?fa[ra+1]:void 0)&&pa&&(qa.vertices.push(new THREE.Vector3(50*ta,50*sa,50*ra+50),new THREE.Vector3(50*ta+50,50*sa,50*ra+50),new THREE.Vector3(50*ta+50,50*sa,50*ra+50),new THREE.Vector3(50*ta+50,50*sa+50,50*ra+50),new THREE.Vector3(50*ta+50,50*sa+50,50*ra+50),new THREE.Vector3(50*ta,50*sa+50,50*ra+50),new THREE.Vector3(50*ta,50*sa+50,50*ra+50),new THREE.Vector3(50*ta,50*sa,50*ra+50)),qa.colors.push(pa,pa,pa,pa,pa,pa,pa,pa)),null==(null!=(ga=this.voxels[ta])&&null!=(ha=ga[sa])?ha[ra-1]:void 0)&&pa&&(qa.vertices.push(new THREE.Vector3(50*ta,50*sa,50*ra),new THREE.Vector3(50*ta+50,50*sa,50*ra),new THREE.Vector3(50*ta+50,50*sa,50*ra),new THREE.Vector3(50*ta+50,50*sa+50,50*ra),new THREE.Vector3(50*ta+50,50*sa+50,50*ra),new THREE.Vector3(50*ta,50*sa+50,50*ra),new THREE.Vector3(50*ta,50*sa+50,50*ra),new THREE.Vector3(50*ta,50*sa,50*ra)),qa.colors.push(pa,pa,pa,pa,pa,pa,pa,pa))));return this.mesh=new THREE.Mesh(i,new THREE.MeshFaceMaterial(q)),this.renderWireframes>0&&(n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:2}),this.wireframe=new THREE.Line(qa,n,THREE.LinePieces),this.scene.add(this.wireframe)),this.scene.add(this.mesh),f?void 0:this.controls.needsRender=!0},a.prototype.animate=function(){return requestAnimationFrame(function(a){return function(){return a.animate()}}(this)),this.embedded||this.stats.begin(),this.controls.update(this.stats)},a.prototype.render=function(a){return this.ssao?(this.scene.overrideMaterial=this.depthMaterial,this.renderer.render(this.scene,this.camera,this.depthRenderTarget,!0),this.scene.overrideMaterial=null,this.composer.render()):this.renderer.render(this.scene,this.camera),this.embedded||this.stats.end(),a?window.open(this.renderer.domElement.toDataURL(),"Exported png"):void 0},a.prototype.onWindowResize=function(){var a;return this.width=this.domContainer.width(),this.height=this.domContainer.height(),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.ssao&&(a=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter}),this.ssaoPass.uniforms.tDepth.value=a,this.ssaoPass.uniforms.size.value.set(this.width,this.height)),this.controls.needsRender=!0},a}(),"object"==typeof module?module.exports=a:window.Renderer=a}.call(this),function(){"use strict";var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty,d=function(a,b){return(+a%(b=+b)+b)%b},e=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=function(a){function c(a,b,d){this.embedded=null!=b?b:!1,this.domContainer=null!=d?d:$("#WebGlContainer"),this.objects=[],c.__super__.constructor.call(this,a,this.embedded,this.domContainer,parseInt($("#renderMode").val()),parseInt($("#renderWireframes").val()),"1"===$("#rendererPostEffect").val(),"2"===$("#rendererPostEffect").val(),"0"===$("#renderControls").val()),this.rollOverMesh=new THREE.Mesh(new THREE.BoxGeometry(48,48,48),new THREE.MeshBasicMaterial({wireframe:!0,color:0})),this.scene.add(this.rollOverMesh),this.vector=new THREE.Vector3,this.raycaster=new THREE.Raycaster,this.setupGrid(),this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.domContainer.append(this.stats.domElement),this.changeEditMode($("#modeEdit").parent().hasClass("active")),this.domContainer.on("mousedown",function(a){return function(b){return a.onDocumentMouseDown(b)}}(this)),this.domContainer.on("mousemove",function(a){return function(b){return a.onDocumentMouseMove(b)}}(this)),document.addEventListener("keydown",function(a){return function(b){return a.onDocumentKeyDown(b)}}(this)),document.addEventListener("keyup",function(a){return function(b){return a.onDocumentKeyUp(b)}}(this)),this.animate()}return b(c,a),c.prototype.setupGrid=function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(this.planes=[],a=new THREE.PlaneBufferGeometry(50*this.x,50*this.y),a.applyMatrix((new THREE.Matrix4).makeRotationY(Math.PI/2)),f=new THREE.Mesh(a),f.position.y=25*this.y,f.position.z=25*this.x,f.visible=!1,this.scene.add(f),this.objects.push(f),this.planes.push(f),a=new THREE.PlaneBufferGeometry(50*this.z,50*this.x),a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),f=new THREE.Mesh(a),f.position.x=25*this.z,f.position.z=25*this.x,f.visible=!1,this.scene.add(f),this.objects.push(f),this.planes.push(f),a=new THREE.PlaneBufferGeometry(50*this.y,50*this.z),a.applyMatrix((new THREE.Matrix4).makeRotationZ(-Math.PI/2)),a.applyMatrix((new THREE.Matrix4).makeRotationX(Math.PI)),f=new THREE.Mesh(a),f.position.x=25*this.z,f.position.y=25*this.y,f.position.z=50*this.x,f.visible=!1,this.scene.add(f),this.objects.push(f),this.planes.push(f),a=new THREE.Geometry,j=b=0,g=this.x;g>=b;j=b+=1)a.vertices.push(new THREE.Vector3(0,0,50*j)),a.vertices.push(new THREE.Vector3(50*this.z,0,50*j)),a.vertices.push(new THREE.Vector3(0,0,50*j)),a.vertices.push(new THREE.Vector3(0,50*this.y,50*j));for(k=c=0,h=this.y;h>=c;k=c+=1)a.vertices.push(new THREE.Vector3(0,50*k,50*this.x)),a.vertices.push(new THREE.Vector3(50*this.z,50*k,50*this.x)),a.vertices.push(new THREE.Vector3(0,50*k,0)),a.vertices.push(new THREE.Vector3(0,50*k,50*this.x));for(l=d=0,i=this.z;i>=d;l=d+=1)a.vertices.push(new THREE.Vector3(50*l,0,0)),a.vertices.push(new THREE.Vector3(50*l,0,50*this.x)),a.vertices.push(new THREE.Vector3(50*l,0,50*this.x)),a.vertices.push(new THREE.Vector3(50*l,50*this.y,50*this.x));return e=new THREE.LineBasicMaterial({color:0,opacity:.2,transparent:!0}),this.grid=new THREE.Line(a,e,THREE.LinePieces),this.scene.add(this.grid)},c.prototype.changeEditMode=function(a){return this.editMode=a,this.editMode?(this.grid.visible=!0,this.rollOverMesh.visible=!0,this.controls.enabled=!1):(this.grid.visible=!1,this.rollOverMesh.visible=!1,this.controls.enabled=!0),this.controls.needsRender=!0},c.prototype.reload=function(a,b,d,e,f,g){var h,i,j,k;if(this.voxels=a,this.x=b,this.y=d,this.z=e,null==f&&(f=!1),null==g&&(g=!1),f){for(k=this.planes,h=0,i=k.length;i>h;h++)j=k[h],this.scene.remove(j),j.geometry.dispose();this.scene.remove(this.grid),this.grid.geometry.dispose(),this.setupGrid(),this.changeEditMode($("#modeEdit").parent().hasClass("active"))}return g||(this.objects=this.planes.slice(0)),c.__super__.reload.call(this,this.voxels,this.x,this.y,this.z,f,g),this.objects.push(this.mesh)},c.prototype.onDocumentMouseMove=function(a){var b,c;if(this.editMode&&"block"!==$("#openModal").css("display")&&"block"!==$("#exportModal").css("display")&&"block"!==$("#saveModal").css("display"))return a.preventDefault(),this.vector.set(a.clientX/this.width*2-1,2*-((a.clientY-50)/this.height)+1,.5),this.vector.unproject(this.camera),this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize()),c=this.raycaster.intersectObjects(this.objects),c.length>0&&(b=c[0],this.rollOverMesh.position.copy(b.point).add(b.face.normal),this.rollOverMesh.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25)),this.controls.needsRender=!0},c.prototype.onDocumentMouseDown=function(a){var b,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;if(this.editMode&&"block"!==$("#openModal").css("display")&&"block"!==$("#exportModal").css("display")&&"block"!==$("#saveModal").css("display")&&(j=function(a,b,c){var e;return b>0&&(a.multiplyScalar(2*Math.random()*b+1-b),a.r>1&&(a.r=1),a.g>1&&(a.g=1),a.b>1&&(a.b=1)),c>0&&(e=a.getHSL(),e.h=d(e.h+.1*(2*Math.random()*c-c),1),e.s=Math.max(0,Math.min(1,e.s+2*Math.random()*c-c)),e.l=Math.max(0,Math.min(1,e.l+2*Math.random()*c-c)),a.setHSL(e.h,e.s,e.l)),a},this.vector.set(a.clientX/this.width*2-1,2*-((a.clientY-50)/this.height)+1,.5),this.vector.unproject(this.camera),this.raycaster.ray.set(this.camera.position,this.vector.sub(this.camera.position).normalize()),m=this.raycaster.intersectObjects(this.objects),m.length>0)){switch(l=m[0],a.button){case 0:switch($(".active .editTool").data("edittool")){case 0:if(g=j(new THREE.Color($("#addVoxColor").val()),parseFloat($("#editVoxNoiseBright").val(),parseFloat($("#editVoxNoiseHSL").val()))),b=parseInt($("#addVoxAlpha").val()),E=parseInt($("#addVoxType").val()),D=parseInt($("#addVoxSpecular").val()),(0===E||3===E)&&(b=255),0!==E&&3!==E&&(D=0),"#ff00ff"===$("#addVoxColor").val()&&(b=250,E=D=7),l.point.add(l.face.normal).divideScalar(50).floor(),I=l.point.z,J=l.point.y,K=l.point.x,!(I>=0&&I<this.x&&J>=0&&J<this.y&&K>=0&&K<this.z))return;null==this.voxels[K]&&(this.voxels[K]=[]),null==this.voxels[K][J]&&(this.voxels[K][J]=[]),this.voxels[K][J][I]={r:Math.floor(255*g.r),g:Math.floor(255*g.g),b:Math.floor(255*g.b),a:b,t:E,s:D};break;case 1:if(s=l.object,e.call(this.planes,s)>=0)return;l.point.add(l.face.normal).divideScalar(50).floor().sub(l.face.normal).round(),I=l.point.z,J=l.point.y,K=l.point.x,g=j(new THREE.Color($("#addVoxColor").val()),parseFloat($("#editVoxNoiseBright").val(),parseFloat($("#editVoxNoiseHSL").val()))),b=parseInt($("#addVoxAlpha").val()),E=parseInt($("#addVoxType").val()),D=parseInt($("#addVoxSpecular").val()),(0===E||3===E)&&(b=255),0!==E&&3!==E&&(D=0),1===g.r&&0===g.g&&1===g.b&&(b=250,E=D=7),this.voxels[K][J][I].r=Math.floor(255*g.r),this.voxels[K][J][I].g=Math.floor(255*g.g),this.voxels[K][J][I].b=Math.floor(255*g.b),this.voxels[K][J][I].a=b,this.voxels[K][J][I].t=E,this.voxels[K][J][I].s=D}break;case 2:if(t=l.object,e.call(this.planes,t)>=0)return;switch(l.point.add(l.face.normal).divideScalar(50).floor().sub(l.face.normal).round(),I=l.point.z,J=l.point.y,K=l.point.x,$(".active .editTool").data("edittool")){case 0:delete this.voxels[K][J][I],0===this.voxels[K][J].filter(function(a){return void 0!==a}).length&&delete this.voxels[K][J],0===this.voxels[K].filter(function(a){return void 0!==a}).length&&delete this.voxels[K];break;case 1:if(i=function(a,b,c){var d,e;return null!=(null!=(d=this.voxels[a])&&null!=(e=d[b])?e[c]:void 0)&&!this.voxels[a][b][c].filled&&(!h||G.r===this.voxels[a][b][c].r&&G.g===this.voxels[a][b][c].g&&G.b===this.voxels[a][b][c].b&&G.a===this.voxels[a][b][c].a&&G.t===this.voxels[a][b][c].t&&G.s===this.voxels[a][b][c].s)},f=new THREE.Color($("#addVoxColor").val()),q=parseFloat($("#editVoxNoiseBright").val()),r=parseFloat($("#editVoxNoiseHSL").val()),h=$("#fillSameColor").prop("checked"),b=parseInt($("#addVoxAlpha").val()),E=parseInt($("#addVoxType").val()),D=parseInt($("#addVoxSpecular").val()),(0===E||3===E)&&(b=255),0!==E&&3!==E&&(D=0),16711935===f.getHex())return;for(F=[[K,J,I]],this.voxels[K][J][I].filled=!0,g=new THREE.Color;F.length>0;)v=F.pop(),K=v[0],J=v[1],I=v[2],G={r:this.voxels[K][J][I].r,g:this.voxels[K][J][I].g,b:this.voxels[K][J][I].b,a:this.voxels[K][J][I].a,t:this.voxels[K][J][I].t,s:this.voxels[K][J][I].s},g=j(g.copy(f),q,r),this.voxels[K][J][I].r=Math.floor(255*g.r),this.voxels[K][J][I].g=Math.floor(255*g.g),this.voxels[K][J][I].b=Math.floor(255*g.b),1===g.r&&0===g.g&&1===g.b&&(this.voxels[K][J][I].g=1),this.voxels[K][J][I].a=b,this.voxels[K][J][I].t=E,this.voxels[K][J][I].s=D,i.call(this,K,J,I+1)&&(this.voxels[K][J][I+1].filled=!0,F.push([K,J,I+1])),i.call(this,K,J,I-1)&&(this.voxels[K][J][I-1].filled=!0,F.push([K,J,I-1])),i.call(this,K,J+1,I)&&(this.voxels[K][J+1][I].filled=!0,F.push([K,J+1,I])),i.call(this,K,J-1,I)&&(this.voxels[K][J-1][I].filled=!0,F.push([K,J-1,I])),i.call(this,K+1,J,I)&&(this.voxels[K+1][J][I].filled=!0,F.push([K+1,J,I])),i.call(this,K-1,J,I)&&(this.voxels[K-1][J][I].filled=!0,F.push([K-1,J,I]));for(K=k=0,w=this.z;w>k;K=k+=1)if(null!=this.voxels[K])for(J=o=0,x=this.y;x>o;J=o+=1)if(null!=(null!=(y=this.voxels[K])?y[J]:void 0))for(I=p=0,z=this.x;z>p;I=p+=1)null!=(null!=(A=this.voxels[K])&&null!=(B=A[J])?B[I]:void 0)&&this.voxels[K][J][I].filled&&delete this.voxels[K][J][I].filled}break;case 1:if(C=l.object,e.call(this.planes,C)>=0)return;return l.point.add(l.face.normal).divideScalar(50).floor().sub(l.face.normal).round(),I=l.point.z,J=l.point.y,K=l.point.x,H=this.voxels[K][J][I],$("#addVoxColor").val("#"+new THREE.Color(H.r/255,H.g/255,H.b/255).getHexString()),H.r===(u=H.b)&&255===u&&0===H.g?$("#addVoxColor").change():($("#addVoxAlpha").val(H.a),$("#addVoxType").val(H.t),$("#addVoxSpecular").val(H.s),$("#addVoxColor").change())}this.reload(this.voxels,this.x,this.y,this.z,!1,!1),n={voxels:this.voxels,x:this.x,y:this.y,z:this.z},c=new Base64IO(n).export(!1);try{history.pushState(n,"Troxel","#m="+c)}catch(a){history.pushState(null,"Troxel","#m="+c)}return this.controls.needsRender=!0}},c.prototype.onDocumentKeyDown=function(a){if(1!==$(".active #modeView").length)switch(a.keyCode){case 18:return this.controls.enabled=!0,this.editMode=!1}},c.prototype.onDocumentKeyUp=function(a){if(1!==$(".active #modeView").length)switch(a.keyCode){case 18:return this.controls.enabled=!1,this.editMode=!0}},c}(Renderer),"object"==typeof module?module.exports=a:window.Editor=a}.call(this),function(){"use strict";var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;THREE.TroxelControls=function(b){function c(a,b){this.object=a,this.domElement=b,this.enabled=!0,this.mode=!0,this.target=new THREE.Vector3,this.noZoom=!1,this.zoomSpeed=.95,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.autoRotate=!1,this.autoRotateSpeed=-4,this.noKeys=!1,this.needsRender=!1,this.EPS=1e-6,this.rotateStart=new THREE.Vector2,this.rotateEnd=new THREE.Vector2,this.rotateDelta=new THREE.Vector2,this.panStart=new THREE.Vector2,this.panEnd=new THREE.Vector2,this.panDelta=new THREE.Vector2,this.panOffset=new THREE.Vector3,this.offset=new THREE.Vector3,this.dollyStart=new THREE.Vector2,this.dollyEnd=new THREE.Vector2,this.dollyDelta=new THREE.Vector2,this.theta=0,this.phi=0,this.phiDelta=0,this.thetaDelta=0,this.scale=1,this.pan=new THREE.Vector3,this.lastPosition=new THREE.Vector3,this.lastQuaternion=new THREE.Quaternion,this.STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5,FLY:6},this.state=this.STATE.NONE,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.quat=(new THREE.Quaternion).setFromUnitVectors(this.object.up,new THREE.Vector3(0,1,0)),this.quatInverse=this.quat.clone().inverse(),this.moveVector=new THREE.Vector3,this.rotationVector=new THREE.Vector3,this.tmpQuaternion=new THREE.Quaternion,this.mousefly=!1,this.domElement.addEventListener("contextmenu",function(a){return a.preventDefault()}),this.domElement.addEventListener("mousedown",function(a){return function(b){return a.onMouseDown(b)}}(this)),document.addEventListener("mouseup",function(a){return function(b){return a.onMouseUp(b)}}(this)),document.addEventListener("mousemove",function(a){return function(b){return a.onMouseMove(b)}}(this)),this.domElement.addEventListener("mousewheel",function(a){return function(b){return a.onMouseWheel(b)}}(this)),this.domElement.addEventListener("DOMMouseScroll",function(a){return function(b){return a.onMouseWheel(b)}}(this)),this.domElement.addEventListener("touchstart",function(a){return function(b){return a.touchstart(b)}}(this)),this.domElement.addEventListener("touchend",function(a){return function(b){return a.touchend(b)}}(this)),this.domElement.addEventListener("touchmove",function(a){return function(b){return a.touchmove(b)}}(this)),window.addEventListener("keydown",function(a){return function(b){return a.onKeyDown(b)}}(this)),window.addEventListener("keyup",function(a){return function(b){return a.onKeyUp(b)}}(this)),this.object.lookAt(this.target),this.update()}var d;return a(c,b),c.prototype.rotateLeft=function(a){return null==a&&(a=2*Math.PI/60/60*this.autoRotateSpeed),this.thetaDelta-=a},c.prototype.rotateUp=function(a){return null==a&&(a=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta-=a},c.prototype.panLeft=function(a){var b;return b=this.object.matrix.elements,this.panOffset.set(b[0],b[1],b[2]),this.panOffset.multiplyScalar(-a),this.pan.add(this.panOffset)},c.prototype.panUp=function(a){var b;return b=this.object.matrix.elements,this.panOffset.set(b[4],b[5],b[6]),this.panOffset.multiplyScalar(a),this.pan.add(this.panOffset)},c.prototype.panXY=function(a,b){var c,d;return this.object instanceof THREE.PerspectiveCamera?(c=this.object.position,d=c.clone().sub(this.target).length(),d*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*a*d/this.domElement.clientHeight),this.panUp(2*b*d/this.domElement.clientHeight)):console.warn("WARNING: Controls.js only supports perspective camera type.")},c.prototype.dollyIn=function(a){return null==a&&(a=this.zoomSpeed),this.scale/=a},c.prototype.dollyOut=function(a){return null==a&&(a=this.zoomSpeed),this.scale*=a},c.prototype.update=function(a){var b,c;return this.mode?(b=this.object.position,this.offset.copy(b).sub(this.target),this.offset.applyQuaternion(this.quat),this.theta=Math.atan2(this.offset.x,this.offset.z),this.phi=Math.atan2(Math.sqrt(this.offset.x*this.offset.x+this.offset.z*this.offset.z),this.offset.y),this.autoRotate&&this.state===this.STATE.NONE&&this.rotateLeft(2*Math.PI/60/60*this.autoRotateSpeed),this.theta+=this.thetaDelta,this.phi+=this.phiDelta,this.phi=Math.max(this.EPS,Math.min(Math.PI-this.EPS,this.phi)),c=this.offset.length()*this.scale,c=Math.max(this.minDistance,Math.min(this.maxDistance,c)),
this.target.add(this.pan),this.offset.x=c*Math.sin(this.phi)*Math.sin(this.theta),this.offset.y=c*Math.cos(this.phi),this.offset.z=c*Math.sin(this.phi)*Math.cos(this.theta),this.offset.applyQuaternion(this.quatInverse),b.copy(this.target).add(this.offset),this.object.lookAt(this.target),this.thetaDelta=0,this.phiDelta=0,this.scale=1,this.pan.set(0,0,0)):(this.object.translateX(20*this.moveVector.x),this.object.translateY(20*this.moveVector.y),this.object.translateZ(20*this.moveVector.z),this.tmpQuaternion.set(.005*this.rotationVector.x,.005*this.rotationVector.y,.005*this.rotationVector.z,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),this.object.rotation.setFromQuaternion(this.object.quaternion,this.object.rotation.order)),this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS?(this.dispatchEvent({type:"change"}),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.needsRender=!1):this.needsRender?(this.dispatchEvent({type:"change"}),this.needsRender=!1):null!=a?a.end():void 0},d=function(){return this.state=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update()},c.prototype.onMouseDown=function(a){if(this.enabled){if(a.preventDefault(),this.mode){if(0===a.button){if(this.noRotate)return;this.state=this.STATE.ROTATE,this.rotateStart.set(a.clientX,a.clientY)}else if(1===a.button){if(this.noZoom)return;this.state=this.STATE.DOLLY,this.dollyStart.set(a.clientX,a.clientY)}else if(2===a.button){if(this.noPan)return;this.state=this.STATE.PAN,this.panStart.set(a.clientX,a.clientY)}}else this.mousefly=!0,this.state=this.STATE.FLY,0===a.button?this.moveVector.z=-1:2===a.button&&(this.moveVector.z=1);return this.state!==this.STATE.NONE?this.dispatchEvent({type:"start"}):void 0}},c.prototype.onMouseMove=function(a){var b,c;if(this.enabled){if(a.preventDefault(),this.state===this.STATE.ROTATE){if(this.noRotate)return;this.rotateEnd.set(a.clientX,a.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight*this.rotateSpeed),this.rotateStart.copy(this.rotateEnd)}else if(this.state===this.STATE.DOLLY){if(this.noZoom)return;this.dollyEnd.set(a.clientX,a.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyIn():this.dollyDelta.y<0&&this.dollyOut(),this.dollyStart.copy(this.dollyEnd)}else if(this.state===this.STATE.PAN){if(this.noPan)return;this.panEnd.set(a.clientX,a.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panXY(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}else this.mousefly&&(c=this.domElement.clientWidth/2,b=this.domElement.clientHeight/2,this.rotationVector.y=-(a.clientX-c)/c,this.rotationVector.x=-(a.clientY-b)/b);return this.state!==this.STATE.NONE&&this.mode?this.update():void 0}},c.prototype.onMouseUp=function(){return this.enabled?(this.moveVector.z=0,this.dispatchEvent({type:"end"}),this.state=this.STATE.NONE):void 0},c.prototype.onMouseWheel=function(a){var b;if(this.enabled&&!this.noZoom&&this.state===this.STATE.NONE&&this.mode)return a.preventDefault(),a.stopPropagation(),b=0,null!=a.wheelDelta?b=a.wheelDelta:null!=a.detail&&(b=-a.detail),b>0?this.dollyOut():0>b&&this.dollyIn(),this.update(),this.dispatchEvent({type:"start"}),this.dispatchEvent({type:"end"})},c.prototype.onKeyDown=function(a){if(this.enabled&&!this.noKeys)if(this.mode){if(!this.noRotate)switch(a.keyCode){case 87:this.rotateUp(-.05),this.update();break;case 65:this.rotateLeft(-.05),this.update();break;case 83:this.rotateUp(.05),this.update();break;case 68:this.rotateLeft(.05),this.update()}if(!this.noZoom)switch(a.keyCode){case 81:this.dollyIn(),this.update();break;case 69:this.dollyOut(),this.update()}if(!this.noPan)switch(a.keyCode){case 38:return this.panXY(0,7),this.update();case 40:return this.panXY(0,-7),this.update();case 37:return this.panXY(7,0),this.update();case 39:return this.panXY(-7,0),this.update()}}else switch(this.mousefly&&(this.rotationVector.set(0,0,0),this.mousefly=!1),a.keyCode){case 87:return this.moveVector.z=-1;case 83:return this.moveVector.z=1;case 65:return this.moveVector.x=-1;case 68:return this.moveVector.x=1;case 82:return this.moveVector.y=1;case 70:return this.moveVector.y=-1;case 38:return this.rotationVector.x=-1;case 40:return this.rotationVector.x=1;case 37:return this.rotationVector.y=1;case 39:return this.rotationVector.y=-1;case 81:return this.rotationVector.z=1;case 69:return this.rotationVector.z=-1}},c.prototype.onKeyUp=function(a){if(this.enabled&&!this.noKeys&&!this.mode)switch(a.keyCode){case 87:return this.moveVector.z=0;case 83:return this.moveVector.z=0;case 65:return this.moveVector.x=0;case 68:return this.moveVector.x=0;case 82:return this.moveVector.y=0;case 70:return this.moveVector.y=0;case 38:return this.rotationVector.x=0;case 40:return this.rotationVector.x=0;case 37:return this.rotationVector.y=0;case 39:return this.rotationVector.y=0;case 81:return this.rotationVector.z=0;case 69:return this.rotationVector.z=0}},c.prototype.touchstart=function(a){var b,c;if(this.enabled&&this.mode){switch(a.touches.length){case 1:if(this.noRotate)return;this.state=this.STATE.TOUCH_ROTATE,this.rotateStart.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(this.noZoom)return;this.state=this.STATE.TOUCH_DOLLY,b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,this.dollyStart.set(0,Math.sqrt(b*b+c*c));break;case 3:if(this.noPan)return;this.state=this.STATE.TOUCH_PAN,this.panStart.set(a.touches[0].pageX,a.touches[0].pageY);break;default:this.state=this.STATE.NONE}return this.state!==this.STATE.NONE?this.dispatchEvent({type:"start"}):void 0}},c.prototype.touchmove=function(a){var b,c;if(this.enabled&&this.mode)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(this.noRotate||this.state!==this.STATE.TOUCH_ROTATE)return;return this.rotateEnd.set(a.touches[0].pageX,a.touches[0].pageY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight*this.rotateSpeed),this.rotateStart.copy(this.rotateEnd),this.update();case 2:if(this.noZoom||this.state!==this.STATE.TOUCH_DOLLY)return;return b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,this.dollyEnd.set(0,Math.sqrt(b*b+c*c)),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut():this.dollyDelta.y<0&&this.dollyIn(),this.dollyStart.copy(this.dollyEnd),this.update();case 3:if(this.noPan||this.state!==this.STATE.TOUCH_PAN)return;return this.panEnd.set(a.touches[0].pageX,a.touches[0].pageY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panXY(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.update();default:return this.state=this.STATE.NONE}},c.prototype.touchend=function(){return this.enabled&&this.mode?(this.dispatchEvent({type:"end"}),this.state=this.STATE.NONE):void 0},c}(THREE.EventDispatcher)}.call(this),function(){"use strict";var a;a=function(){function a(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(this.io=a,this.type=b,this.errors=[],this.warnings=[],this.infos=[],i=this.io.computeBoundingBox(),p=i[0],q=i[1],r=i[2],f=i[3],g=i[4],h=i[5],this.io.resize(p,q,r,f,g,h),r=c=0,j=this.io.z;j>c;r=c+=1)if(null!=this.io.voxels[r])for(q=d=0,k=this.io.y;k>d;q=d+=1)if(null!=this.io.voxels[r][q])for(p=e=0,l=this.io.x;l>e;p=e+=1)null!=this.io.voxels[r][q][p]&&null!=this.io.voxels[r][q][p].linter&&delete this.io.voxels[r][q][p].linter;switch(this.hasNoAlphaOnSolidVoxels(),this.hasNoSpecularOnNonSolidVoxels(),this.hasNoBlackVoxels(),"lair"!==(m=this.type)&&"dungeon"!==m&&this.hasNoFloatingVoxels(),"lair"!==(n=this.type)&&"dungeon"!==n&&this.usesMaterialMaps(),"deco"!==(o=this.type)&&"lair"!==o&&"dungeon"!==o&&this.hasExactlyOneAttachmentPoint(),this.type){case"melee":this.validateMelee();break;case"gun":this.validateGun();break;case"staff":this.validateStaff();break;case"bow":this.validateBow();break;case"spear":this.validateSpear();break;case"mask":this.validateMask();break;case"hat":this.validateHat();break;case"hair":this.validateHair();break;case"deco":this.validateDeco();break;default:this.infos.push({title:"Linting lairs and dungeons not yet supported!",body:"Linting lairs and dungeons is not yet supported. Get feedback in the Trove Creations reddit!"})}}return a.prototype.hasExactlyOneAttachmentPoint=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(a=0,l=!1,p=b=0,e=this.io.z;e>b;p=b+=1)if(null!=this.io.voxels[p])for(o=c=0,f=this.io.y;f>c;o=c+=1)if(null!=this.io.voxels[p][o])for(n=d=0,g=this.io.x;g>d;n=d+=1)null!=this.io.voxels[p][o][n]&&(m=this.io.voxels[p][o][n],(7===m.t||7===m.s||250===m.a||m.r===(h=m.b)&&255===h&&0===m.g)&&(a++,l=m.t===(i=m.s)&&7===i&&250===m.a&&m.r===(j=m.b)&&255===j&&0===m.g,this.io.voxels[p][o][n].linter=255));return 1===a?(l?(k=this.io.getAttachmentPoint(),n=k[0],o=k[1],p=k[2],delete this.io.voxels[p][o][n].linter):this.errors.push({title:"Attachment point not in all material maps found!",body:"Your attachment point is only marked in some but not all material maps as a pink voxel. You need to change the voxel to a pink (255, 0, 255) voxel in all material maps!",footer:"You have to mark the attachment point with the blue wireframe in every material map as a a pink (255, 0, 255) voxel!"}),this.correctAttachmentPoint=!0):(this.correctAttachmentPoint=!1,0===a?this.errors.push({title:"No attachment point found!",body:"You need to specify an attachment point, a (255, 0, 255) = #FF00FF pink voxel, thereby your model will be aligned correctly ingame. Check out the guide for your specific creation type linked in the blue infobox below for more informations!"}):this.errors.push({title:"Multiple attachment points found!",body:"You have more the one attachment point in your model ("+a+" found). Avoid the usage of excatly pink (255, 0, 255) voxels in your model except for the attachment point in EVERY material map.",footer:"All voxels considers as an attachment point are now marked with a blue wireframe. Check all marked voxels you don't want as an attachment point for pink colors in any of the material map and recolor them accordingly!"}))},a.prototype.hasNoAlphaOnSolidVoxels=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(i=!1,m=a=0,d=this.io.z;d>a;m=a+=1)if(null!=this.io.voxels[m])for(l=b=0,e=this.io.y;e>b;l=b+=1)if(null!=this.io.voxels[m][l])for(k=c=0,f=this.io.x;f>c;k=c+=1)null!=this.io.voxels[m][l][k]&&(j=this.io.voxels[m][l][k],0!==(g=j.t)&&3!==g||16===(h=j.a)||255===h||(i=!0,this.io.voxels[m][l][k].linter=16744192));return i?this.warnings.push({title:"Alpha material map used on a solid voxel!",body:'You have set a transparent alpha map value on a solid voxel, but transparency is only supported for all types of glass blocks. Consider checking your type map so that all voxel that should be transparent have a glass type set (or unset the alpha value from all solid voxels). Check out the <a href="http://trove.wikia.com/wiki/Material_Map_Guide" class="alert-link" target="_blank">Material Map Guide</a> for more informations!',footer:"Recheck the material map of all voxels now marked with an orange wireframe!"}):void 0},a.prototype.hasNoSpecularOnNonSolidVoxels=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(i=!1,a=!1,m=b=0,e=this.io.z;e>b;m=b+=1)if(null!=this.io.voxels[m])for(l=c=0,f=this.io.y;f>c;l=c+=1)if(null!=this.io.voxels[m][l])for(k=d=0,g=this.io.x;g>d;k=d+=1)null!=this.io.voxels[m][l][k]&&(j=this.io.voxels[m][l][k],1!==(h=j.t)&&2!==h&&4!==h||0===j.s?3===j.t&&0!==j.s&&(a=!0):(i=!0,this.io.voxels[m][l][k].linter=16776960));return i?this.warnings.push({title:"Specular material map used on non solid voxel!",body:'You have changed the specular map value on a non solid voxel, but specular values are only supported for solid voxels. Consider checking your type map so that all voxel that should have a specular value are set to solid OR change the specular map value of all non solid voxels to rough. Check out the <a href="http://trove.wikia.com/wiki/Material_Map_Guide" class="alert-link" target="_blank">Material Map Guide</a> for more informations!',footer:"Recheck the material map of all voxels now marked with an yellow wireframe!"}):a?this.infos.push({title:"Specular material map usage is bugged on glowing solid voxel!",body:"Rendering specular map effects on glowing solid voxel is bugged in the current game engine. Don't rely on your specular map values other than rough having any visual effect ingame. For now using anything other than rought on glowing solid voxel is not recommended!"}):void 0},a.prototype.hasNoBlackVoxels=function(){var a,b,c,d,e,f,g,h,i,j,k;for(g=!1,k=a=0,d=this.io.z;d>a;k=a+=1)if(null!=this.io.voxels[k])for(j=b=0,e=this.io.y;e>b;j=b+=1)if(null!=this.io.voxels[k][j])for(i=c=0,f=this.io.x;f>c;i=c+=1)null!=this.io.voxels[k][j][i]&&(h=this.io.voxels[k][j][i],Math.min(h.r,h.g,h.b)+Math.max(h.r,h.g,h.b)<20&&(g=!0,this.io.voxels[k][j][i].linter=16777215));return g?this.errors.push({title:"Too dark voxel found!",body:"There shouldn't be voxels darker than (10, 10, 10) in your voxel model, but we found a voxel with ("+h.r+", "+h.g+", "+h.b+'). Try to use a (brighter) dark grey voxel instead. Check out the <a href="http://trove.wikia.com/wiki/Style_guidelines#Full_Black" class="alert-link" target="_blank">style guide</a> for more informations!',footer:"Increase the brightness of all voxels now marked with an white wireframe!"}):void 0},a.prototype.hasNoFloatingVoxels=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;if(v=this.getStartingVoxel(),null!=v){for(this.io.voxels[v[0][0]][v[0][1]][v[0][2]].checked=!0;v.length>0;)d=v.pop(),y=d[0],x=d[1],w=d[2],null==(null!=(e=this.io.voxels[y])&&null!=(m=e[x])?m[w+1]:void 0)||this.io.voxels[y][x][w+1].checked||(this.io.voxels[y][x][w+1].checked=!0,v.push([y,x,w+1])),null==(null!=(n=this.io.voxels[y])&&null!=(o=n[x])?o[w-1]:void 0)||this.io.voxels[y][x][w-1].checked||(this.io.voxels[y][x][w-1].checked=!0,v.push([y,x,w-1])),null==(null!=(p=this.io.voxels[y])&&null!=(q=p[x+1])?q[w]:void 0)||this.io.voxels[y][x+1][w].checked||(this.io.voxels[y][x+1][w].checked=!0,v.push([y,x+1,w])),null==(null!=(r=this.io.voxels[y])&&null!=(s=r[x-1])?s[w]:void 0)||this.io.voxels[y][x-1][w].checked||(this.io.voxels[y][x-1][w].checked=!0,v.push([y,x-1,w])),null==(null!=(t=this.io.voxels[y+1])&&null!=(f=t[x])?f[w]:void 0)||this.io.voxels[y+1][x][w].checked||(this.io.voxels[y+1][x][w].checked=!0,v.push([y+1,x,w])),null==(null!=(g=this.io.voxels[y-1])&&null!=(h=g[x])?h[w]:void 0)||this.io.voxels[y-1][x][w].checked||(this.io.voxels[y-1][x][w].checked=!0,v.push([y-1,x,w]));for(u=!1,y=a=0,i=this.io.z;i>a;y=a+=1)if(null!=this.io.voxels[y])for(x=b=0,j=this.io.y;j>b;x=b+=1)if(null!=this.io.voxels[y][x])for(w=c=0,k=this.io.x;k>c;w=c+=1)null!=this.io.voxels[y][x][w]&&(this.io.voxels[y][x][w].checked?delete this.io.voxels[y][x][w].checked:(7!==this.io.voxels[y][x][w].t||"hair"!==(l=this.type)&&"hat"!==l&&"mask"!==l)&&(u=!0,this.io.voxels[y][x][w].linter=65535));return u?this.warnings.push({title:"Your model has floating/corner-connected voxels!",body:'There are voxels in your model, which are not directly connected to other voxels (in some cases caused by a unnecessary hole). Read more about voxel placements in the <a href="http://trove.wikia.com/wiki/Style_guidelines#Voxel_Placement" class="alert-link" target="_blank">sytle guides</a>. There will be only a few exceptions where models with floating/corner-connected  voxels will be accepted. Try to avoid them! You will get feedback if this is the case for you in the submission process on the Trove Creations subreddit.',footer:"All voxels marked with an cyan wireframe are not connected to the unmarked voxels. Try to connect them together (adding very transparent voxels doesn't count)!"}):void 0}},a.prototype.getStartingVoxel=function(){var a,b,c,d,e,f,g,h,i,j;for(j=a=0,d=this.io.z;d>a;j=a+=1)if(null!=this.io.voxels[j])for(i=b=0,e=this.io.y;e>b;i=b+=1)if(null!=this.io.voxels[j][i])for(h=c=0,f=this.io.x;f>c;h=c+=1)if(null!=this.io.voxels[j][i][h]&&(7!==this.io.voxels[j][i][h].t||"hair"!==(g=this.type)&&"hat"!==g&&"mask"!==g))return[[j,i,h]]},a.prototype.usesMaterialMaps=function(){var a,b,c,d,e,f,g,h,i;for(i=a=0,d=this.io.z;d>a;i=a+=1)if(null!=this.io.voxels[i])for(h=b=0,e=this.io.y;e>b;h=b+=1)if(null!=this.io.voxels[i][h])for(g=c=0,f=this.io.x;f>c;g=c+=1)if(null!=this.io.voxels[i][h][g]&&(this.io.voxels[i][h][g].t>0||this.io.voxels[i][h][g].s>0)&&7!==this.io.voxels[i][h][g].t)return;return this.infos.push({title:"Material maps not used!",body:'It looks like you haven\'t used any material maps in your voxel model. If you arent yet familiar with them, check out the <a href="http://trove.wikia.com/wiki/Material_Map_Guide" class="alert-link" target="_blank">Material Map Guide</a> for more informations on how you could make voxel look more metallic or like transparent glass for example. You should use them where suitable in your model!'})},a.prototype.validateMelee=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(this.io.x>10||this.io.y>10||this.io.z>35){if(this.io.z<=10&&(this.io.x<=35&&this.io.y<=10||this.io.x<=10&&this.io.y<=35))return this.errors.push({title:"Incorrect melee weapon model oriantation!",body:"Your melee weapon model is incorrectly oriantated and will be thereby held in a wrong direction ingame. Rotate it so that the tip of your weapon is facing the front! Don't forget to fix this in your local files too before creating and submitting the .blueprint."});this.errors.push({title:"Incorrect melee weapon model dimensions!",body:"A melee weapon model should not exceed 10x10x35 voxels, but yours is "+this.io.x+"x"+this.io.y+"x"+this.io.z+'. Check out the <a href="http://trove.wikia.com/wiki/Melee_weapon_creation#Weapon_dimensions" class="alert-link" target="_blank">melee weapon creation guide</a> for more informations!'})}if(this.correctAttachmentPoint){for(g=this.io.getAttachmentPoint(),a=g[0],b=g[1],c=g[2],(b>4||this.io.y-b>6)&&this.warnings.push({title:"Incorrect attachment point height!",body:"There shouldn't be voxels higher than 5 voxel above or lower than 4 voxels below the attachment point! But in your melee weapon model there are up to "+(this.io.y-b-1)+" voxel above and "+b+' voxels below the attachment point. Check out the <a href="http://trove.wikia.com/wiki/Melee_weapon_creation#Handle_size_and_attachment" class="alert-link" target="_blank">melee weapon creation guide</a> for more informations!'}),r=!1,u=d=h=c-1,j=c+1;j>=d;u=d+=1)for(t=e=k=b-1,l=b+1;l>=e;t=e+=1)for(s=f=m=a-1,n=a+1;n>=f;s=f+=1)s===a&&t===b?null==(null!=(o=this.io.voxels[u])&&null!=(p=o[t])?p[s]:void 0)&&(r=!0):null!=(null!=(q=this.io.voxels[u])&&null!=(i=q[t])?i[s]:void 0)&&(r=!0,this.io.voxels[u][t][s].linter=16711680);return r?this.warnings.push({title:"Incorrect attachment point surrounding / handle!",body:'Around the attachment point there should be only one voxel on either side lengthwise and nothing else in a 3x3x3 cube around the attachment point. Check out the <a href="http://trove.wikia.com/wiki/Melee_weapon_creation#Handle_size_and_attachment" class="alert-link" target="_blank">melee weapon creation guide</a> for more informations!',footer:"You have to remove all overlaying voxels now marked with a red wireframe!"}):void 0}},a.prototype.validateGun=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(this.io.x>5||this.io.y>12||this.io.z>5){if(this.io.y<=5&&(this.io.x<=12&&this.io.z<=5||this.io.x<=5&&this.io.z<=12))return this.errors.push({title:"Incorrect gun weapon model oriantation!",body:'Your gun weapon model is incorrectly oriantated and will be thereby held in a wrong direction ingame. Rotate it so that the muzzle is facing down! Check out the <a href="http://trove.wikia.com/wiki/Gun_Weapon_Creation#Weapon_orientation" class="alert-link" target="_blank">gun weapon creation guide</a> for more informations! Don\'t forget to fix this in your local files too before creating and submitting the .blueprint.'});this.errors.push({title:"Incorrect gun weapon model dimensions!",body:"A gun weapon model should not exceed 5x12x5 voxels, but yours is "+this.io.x+"x"+this.io.y+"x"+this.io.z+'. Check out the <a href="http://trove.wikia.com/wiki/Gun_Weapon_Creation#Weapon_dimensions" class="alert-link" target="_blank">gun weapon creation guide</a> for more informations!'})}if(this.correctAttachmentPoint){for(g=this.io.getAttachmentPoint(),a=g[0],b=g[1],c=g[2],0!==c&&this.warnings.push({title:"Incorrect attachment point location!",body:'There shouldn\'t be voxels behind the attachment point. Check out the <a href="http://trove.wikia.com/wiki/Gun_Weapon_Creation#Handle_size_and_attachment" class="alert-link" target="_blank">gun weapon creation guide</a> for more informations! Exceptions may be made for guns which are designed to be worn like a glove.'}),r=!1,u=d=h=c-1,j=c+1;j>=d;u=d+=1)for(t=e=k=b-1,l=b+1;l>=e;t=e+=1)for(s=f=m=a-1,n=a+1;n>=f;s=f+=1)s===a&&t===b&&u>=c?null==(null!=(o=this.io.voxels[u])&&null!=(p=o[t])?p[s]:void 0)&&(r=!0):null!=(null!=(q=this.io.voxels[u])&&null!=(i=q[t])?i[s]:void 0)&&(r=!0,this.io.voxels[u][t][s].linter=16711680);return r?this.warnings.push({title:"Incorrect attachment point surrounding / handle!",body:'Around the attachment point there should be only one voxel to the front and nothing else in a 3x3x3 cube around the attachment point. Check out the <a href="http://trove.wikia.com/wiki/Gun_Weapon_Creation#Handle_size_and_attachment" class="alert-link" target="_blank">gun weapon creation guide</a> for more informations! Exceptions may be made for guns which are designed to be worn like a glove.',footer:"You have to remove all overlaying voxels now marked with a red wireframe!"}):void 0}},a.prototype.validateStaff=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(this.io.x>12||this.io.y>12||this.io.z>35){if(this.io.z<=12&&(this.io.x<=35&&this.io.y<=12||this.io.x<=12&&this.io.y<=35))return this.errors.push({title:"Incorrect staff weapon model oriantation!",body:"Your staff weapon model is incorrectly oriantated and will be thereby held in a wrong direction ingame. Rotate it so that the tip of your weapon is facing the front! Don't forget to fix this in your local files too before creating and submitting the .blueprint."});this.errors.push({title:"Incorrect staff weapon model dimensions!",body:"A staff weapon model should not exceed 12x12x35 voxels, but yours is "+this.io.x+"x"+this.io.y+"x"+this.io.z+'. Check out the <a href="http://trove.wikia.com/wiki/Staff_Creation_Guide#Weapon_Dimensions" class="alert-link" target="_blank">staff weapon creation guide</a> for more informations!'})}if(this.correctAttachmentPoint){for(g=this.io.getAttachmentPoint(),a=g[0],b=g[1],c=g[2],(8>c||c>14)&&this.warnings.push({title:"Incorrect attachment point location!",body:"The handle of the staff befind the attachment point must have a length between 8 and 14 voxels (your handle length: "+c+'). Check out the <a href="http://trove.wikia.com/wiki/Staff_Creation_Guide#Weapon_Dimensions" class="alert-link" target="_blank">staff weapon creation guide</a> for more informations!'}),this.io.z-c<17&&this.warnings.push({title:"Incorrect attachment point location!",body:"There must be at least 16 voxels between attachment point and the tip of your staff (your distance: "+(this.io.z-c-1)+'). Check out the <a href="http://trove.wikia.com/wiki/Staff_Creation_Guide#Weapon_Dimensions" class="alert-link" target="_blank">staff weapon creation guide</a> for more informations!'}),r=!1,u=d=h=c-1,j=c+1;j>=d;u=d+=1)for(t=e=k=b-1,l=b+1;l>=e;t=e+=1)for(s=f=m=a-1,n=a+1;n>=f;s=f+=1)s===a&&t===b?null==(null!=(o=this.io.voxels[u])&&null!=(p=o[t])?p[s]:void 0)&&(r=!0):null!=(null!=(q=this.io.voxels[u])&&null!=(i=q[t])?i[s]:void 0)&&(r=!0,this.io.voxels[u][t][s].linter=16711680);return r?this.warnings.push({title:"Incorrect attachment point surrounding / handle!",body:'Around the attachment point there should be only one voxel on either side lengthwise and nothing else in a 3x3x3 cube around the attachment point. Check out the <a href="http://trove.wikia.com/wiki/Staff_Creation_Guide#Handle_size_and_attachment" class="alert-link" target="_blank">staff weapon creation guide</a> for more informations!',footer:"You have to remove all overlaying voxels now marked with a red wireframe!"}):void 0}},a.prototype.validateBow=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(this.io.x>3||this.io.y>9||this.io.z>21){if(this.io.z<=9&&(this.io.x<=21&&this.io.y<=9||this.io.x<=9&&this.io.y<=21))return this.errors.push({title:"Incorrect bow weapon model oriantation!",body:"You bow weapon model is incorrectly oriantated and will be thereby held in a wrong direction ingame. Rotate it so that the bowstring goes from back to front! Don't forget to fix this in your local files too before creating and submitting the .blueprint."});this.io.x<=5&&this.io.y<=9&&this.io.z<=21?this.warnings.push({title:"Bow model dimensions does not follow guidelines!",body:'Your bow weapon model is more than the allowed 3 voxel thick. Try to reduce the thickness if you can, but if the 5 voxels tickness is really required for your bow and does make sense, go ahead add submit it to get feedback if it can stay this way. Check out the <a href="http://trove.wikia.com/wiki/Bow_Creation_Guide#Basic_Dimensions" class="alert-link" target="_blank">bow weapon creation guide</a> for more informations!'}):this.errors.push({title:"Incorrect bow model dimensions!",body:"A bow weapon model should not exceed 3x9x21 voxels, but yours is "+this.io.x+"x"+this.io.y+"x"+this.io.z+'. Check out the <a href="http://trove.wikia.com/wiki/Bow_Creation_Guide#Basic_Dimensions" class="alert-link" target="_blank">bow weapon creation guide</a> for more informations!'})}if(this.correctAttachmentPoint){for(g=this.io.getAttachmentPoint(),a=g[0],b=g[1],c=g[2],(b>3||this.io.y-b>6)&&this.warnings.push({title:"Incorrect attachment point height!",body:"There shouldn't be voxels higher than 5 voxel above or lower than 3 voxels below the attachment point. But in your bow model there are up to "+(this.io.y-b-1)+" voxel above and "+b+' voxels below the attachment point. Check out the <a href="http://trove.wikia.com/wiki/Bow_Creation_Guide#Basic_Dimensions" class="alert-link" target="_blank">bow weapon creation guide</a> for more informations!'}),r=!1,u=d=h=c-1,j=c+1;j>=d;u=d+=1)for(t=e=k=b-1,l=b+1;l>=e;t=e+=1)for(s=f=m=a-1,n=a+1;n>=f;s=f+=1)s===a&&t===b?null==(null!=(o=this.io.voxels[u])&&null!=(p=o[t])?p[s]:void 0)&&(r=!0):null!=(null!=(q=this.io.voxels[u])&&null!=(i=q[t])?i[s]:void 0)&&(r=!0,this.io.voxels[u][t][s].linter=16711680);return r?this.warnings.push({title:"Incorrect attachment point surrounding / handle!",body:'Around the attachment point there should be only one voxel on either side lengthwise and nothing else in a 3x3x3 cube around the attachment point. Check out the <a href="http://trove.wikia.com/wiki/Bow_Creation_Guide#Other_details" class="alert-link" target="_blank">bow weapon creation guide</a> for more informations!',footer:"You have to remove all overlaying voxels now marked with a red wireframe!"}):void 0}},a.prototype.validateSpear=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(this.io.x>11||this.io.y>11||this.io.z>45){if(this.io.z<=11&&(this.io.x<=45&&this.io.y<=11||this.io.x<=11&&this.io.y<=45))return this.errors.push({title:"Incorrect spear weapon model oriantation!",body:"Your spear weapon model is incorrectly oriantated and will be thereby held in a wrong direction ingame. Rotate it so that the tip/head of your weapon is facing the front! Don't forget to fix this in your local files too before creating and submitting the .blueprint."});this.errors.push({title:"Incorrect spear weapon model dimensions!",body:"A spear weapon model should not exceed 11x11x45 voxels, but yours is "+this.io.x+"x"+this.io.y+"x"+this.io.z+'. Check out the <a href="http://trove.wikia.com/wiki/Spear_Creation_Guide#Weapon_Dimensions" class="alert-link" target="_blank">spear weapon creation guide</a> for more informations!'})}if(this.io.z<45&&this.errors.push({title:"Incorrect spear weapon model length!",body:"A spear weapon model should be exactly 45 voxels long, but yours is only "+this.io.z+' voxel long. Check out the <a href="http://trove.wikia.com/wiki/Spear_Creation_Guide#Weapon_Dimensions" class="alert-link" target="_blank">spear weapon creation guide</a> for more informations!'}),this.correctAttachmentPoint){for(j=this.io.getAttachmentPoint(),a=j[0],b=j[1],c=j[2],(8>c||c>12)&&this.errors.push({title:"Incorrect attachment point position!",body:"The attachment point in the shaft of the spear should be between 9 and 13 voxel away (including the attachment point) from the bottom of the spear (or 6 to 10 from the 3x3 base), but yours is "+(c+1)+" (or "+(c-2)+') voxel away. Check out the <a href="http://trove.wikia.com/wiki/Spear_Creation_Guide#Weapon_Dimensions" class="alert-link" target="_blank">spear creation guide</a> for more informations!'}),o=!1,r=d=0;2>d;r=d+=1)if(null!=this.io.voxels[r])for(q=e=0,k=this.io.y;k>e;q=e+=1)if(null!=this.io.voxels[r][q])for(p=f=0,l=this.io.x;l>f;p=f+=1)null!=this.io.voxels[r][q][p]&&(p>a+1||a-1>p||q>b+1||b-1>q)&&(o=!0,this.io.voxels[r][q][p].linter=16711680);for(o&&this.errors.push({title:"Incorrect spear base!",body:'The spear base should fit in a 3x3x3 area with the shaft connected in the center of the base. Check out the <a href="http://trove.wikia.com/wiki/Spear_Creation_Guide#Weapon_Dimensions" class="alert-link" target="_blank">spear creation guide</a> for more informations!',footer:"You have to remove all overlaying voxels now marked with a red wireframe!"}),o=!1,s=31,r=g=3;30>g;r=g+=1)if(null!=this.io.voxels[r])for(q=h=0,m=this.io.y;m>h;q=h+=1)if(null!=this.io.voxels[r][q])for(p=i=0,n=this.io.x;n>i;p=i+=1)null==this.io.voxels[r][q][p]||p===a&&q===b||(o=!0,s=Math.min(s,r),this.io.voxels[r][q][p].linter=16711680);return o?this.errors.push({title:"Incorrect spear shaft or too long spear head/base!",body:"The spear shaft should only be 1 voxel thick and 27 voxels long and connect the (3 voxel long) spear base with the 15 voxel long spear head. But your spear head is either "+(this.io.z-s)+' voxel long or your spear shaft is too thick. Check out the <a href="http://trove.wikia.com/wiki/Spear_Creation_Guide#Weapon_Dimensions" class="alert-link" target="_blank">spear creation guide</a> for more informations!',footer:"You have to either fix your spear shaft/base length or remove all overlaying voxels now marked with a red wireframe!"}):void 0}},a.prototype.validateMask=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if((this.io.x>10||this.io.y>10)&&this.errors.push({title:"Incorrect mask model dimensions!",body:"A mask model should not exceed 10x10x5 voxels, but yours is "+this.io.x+"x"+this.io.y+"x"+(this.io.z-6)+'. Check out the <a href="http://trove.wikia.com/wiki/Mask_creation#Item_dimensions" class="alert-link" target="_blank">mask creation guide</a> for more informations!'}),this.io.z>11&&this.warnings.push({title:"Very special mask model depth!",body:"There will be only a few exceptions where mask with a depth greater than 5 will be accepted (your depth: "+(this.io.z-6)+'). You will get feedback if this is the case for you in the submission process and Trove Creations reddit. Check out the <a href="http://trove.wikia.com/wiki/Mask_creation#Item_dimensions" class="alert-link" target="_blank">mask creation guide</a> for more informations!'}),this.correctAttachmentPoint){
if(g=this.io.getAttachmentPoint(),a=g[0],b=g[1],c=g[2],0!==c)return this.errors.push({title:"Incorrect mask model oriantation!",body:"You mask model is incorrectly oriantated and will be thereby not weared correctly ingame. Rotate it so that it is facing the front! Don't forget to fix this in your local files too before creating and submitting the .blueprint."});for((a>5||this.io.x-a>5||b>4||this.io.y-b>6)&&this.errors.push({title:"Incorrect attachment point position!",body:"There shouldn't be more than 5 voxels to the right ("+a+"), 4 to the left ("+(this.io.x-a-1)+"), 5 above ("+(this.io.y-b-1)+") and 4 below ("+b+') the attachment point (your models distances are in the brackest). Check out the <a href="http://trove.wikia.com/wiki/Mask_creation#Head_attachment" class="alert-link" target="_blank">mask creation guide</a> on the wiki for are more in depth attachment point position guide.'}),m=6,l=d=0;5>=d;l=d+=1)if(null!=this.io.voxels[l])for(k=e=0,h=this.io.y;h>e;k=e+=1)if(null!=this.io.voxels[l][k])for(j=f=0,i=this.io.x;i>f;j=f+=1)null!=this.io.voxels[l][k][j]&&7!==this.io.voxels[l][k][j].t&&(m=Math.min(m,l),this.io.voxels[l][k][j].linter=16711680);return 6>m?this.errors.push({title:"Incorrect attachment point position!",body:'The attachment point should be 6 voxels behind the mask and there shouldn\'t be any voxels behind this distance. Check out the <a href="http://trove.wikia.com/wiki/Mask_creation#Head_attachment" class="alert-link" target="_blank">mask creation guide</a> for more informations! (minimal distance to the mask was '+m+" instead of 6 voxels)",footer:"You have to either reposition your attachment point or remove all overlaying voxels now marked with a red wireframe!"}):void 0}},a.prototype.validateHat=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if((this.io.x>20||this.io.y>20||this.io.z>20)&&this.errors.push({title:"Incorrect hat model dimensions!",body:"A hat model should not exceed 20x14x20 voxels, but yours is "+this.io.x+"x"+(this.io.y-6)+"x"+this.io.z+'. Check out the <a href="http://trove.wikia.com/wiki/Hat_creation#Item_dimensions" class="alert-link" target="_blank">hat creation guide</a> for more informations!'}),this.correctAttachmentPoint){if(g=this.io.getAttachmentPoint(),a=g[0],b=g[1],c=g[2],0!==b)return this.errors.push({title:"Incorrect hat model oriantation!",body:"You hat model is incorrectly oriantated and will be thereby not weared correctly ingame. Rotate it so that top of the hat is facing up! Don't forget to fix this in your local files too before creating and submitting the .blueprint."});for((a>10||this.io.x-a>10||c>9||this.io.z-c>11)&&this.errors.push({title:"Incorrect attachment point position!",body:"There shouldn't be more than 10 voxels to the right ("+a+"), 9 to the left ("+(this.io.x-a-1)+"), 10 in front of ("+(this.io.z-c-1)+") and 9 behind ("+c+') the attachment point (your models distances are in the brackest). Check out the <a href="http://trove.wikia.com/wiki/Hat_creation#Head_attachment" class="alert-link" target="_blank">hat creation guide</a> on the wiki for are more in depth attachment point position guide.'}),l=6,m=d=0,h=this.io.z;h>d;m=d+=1)if(null!=this.io.voxels[m])for(k=e=0;5>=e;k=e+=1)if(null!=this.io.voxels[m][k])for(j=f=0,i=this.io.x;i>f;j=f+=1)null!=this.io.voxels[m][k][j]&&7!==this.io.voxels[m][k][j].t&&(l=Math.min(l,k),this.io.voxels[m][k][j].linter=16711680);return 6>l?this.errors.push({title:"Incorrect attachment point position!",body:'The attachment point should be 6 voxels below the hat and there shouldn\'t be any voxels below this distance. Check out the <a href="http://trove.wikia.com/wiki/Hat_creation#Head_attachment" class="alert-link" target="_blank">hat creation guide</a> for more informations! (minimal distance to the hat was '+l+" instead of 6 voxels)",footer:"You have to either reposition your attachment point or remove all overlaying voxels now marked with a red wireframe!"}):void 0}},a.prototype.validateHair=function(){var a,b,c,d;return(this.io.x>20||this.io.y>20||this.io.z>20)&&this.errors.push({title:"Incorrect hat model dimensions!",body:"A hair model should not exceed 20x14x20 voxels, but yours is "+this.io.x+"x"+(this.io.y-6)+"x"+this.io.z+'. Check out the <a href="http://trove.wikia.com/wiki/Hair_creation#Item_dimensions" class="alert-link" target="_blank">hair creation guide</a> for more informations!'}),this.correctAttachmentPoint?(d=this.io.getAttachmentPoint(),a=d[0],b=d[1],c=d[2],a>10||this.io.x-a>10||c>9||this.io.z-c>11||b>8||this.io.y-b>12?this.errors.push({title:"Incorrect attachment point position!",body:'Check the <a href="http://trove.wikia.com/wiki/Hair_creation#Head_attachment" class="alert-link" target="_blank">hair creation guide</a> on the wiki for it\'s correct position.'}):void 0):void 0},a.prototype.validateDeco=function(){return this.io.x>12||this.io.y>12||this.io.z>12?this.errors.push({title:"Incorrect decoration model dimensions!",body:"A decorations model should not exceed 12x12x12 voxels, but yours is "+this.io.x+"x"+this.io.y+"x"+this.io.z+'. Check out the <a href="http://trove.wikia.com/wiki/Cornerstone_decoration_creation" class="alert-link" target="_blank">decoration creation guide</a> for more informations!'}):void 0},a}(),"object"==typeof module?module.exports=a:window.TroveCreationsLint=a}.call(this),function(){"use strict";var a,b,c,d,e;d=null,b=null,c=null,a=0,"https:"!==window.location.protocol&&"localhost"!==window.location.hostname&&(window.location.protocol="https"),window.applicationCache.addEventListener("downloading",function(){return a=0,$("#AppCacheProgressFileCount").text(0),$("#AppCacheProgress").show().children().width("0%")}),window.applicationCache.addEventListener("progress",function(){return $("#AppCacheProgressFileCount").text(++a),$("#AppCacheProgress").children().width(100*a/16+"%")}),window.applicationCache.addEventListener("updateready",function(){return $.ajax({url:"static/Recent_Changes.html",cache:!1}).done(function(a){return $("#recentChangesDiv").html(a)}),$("#updateModal").modal("show"),$("#AppCacheProgress").fadeOut(),clearInterval(e)}),window.applicationCache.addEventListener("cached",function(){return $("#AppCacheProgress").fadeOut()}),e=setInterval(function(){return window.applicationCache.update()},3e5),$("#updateLater").click(function(){return e=setInterval(function(){return window.applicationCache.update(),$("#updateModal").modal("show")},parseInt($("#remindUpdateTime").val())),$("#updateModal").modal("hide")}),window.onpopstate=function(a){var b,e,f,g,h,i,j,k,l;if(null!=(null!=a?a.state:void 0))return j=null!=d,k=d.x!==a.state.x||d.y!==a.state.y||d.z!==a.state.z,d=new IO(a.state),null==d.readonly||0===d.readonly?$("#btnExport").show():$("#btnExport").hide(),$("#btnExportPng").show(),j?c.reload(d.voxels,d.x,d.y,d.z,k,!1):c=new Editor(d);for(d=null,h=decodeURI(window.location.hash).replace("#","").split("&"),e=0,f=h.length;f>e;e++){if(b=h[e],i=b.split("="),g=i[0],l=i[1],"m"===g){d=new Base64IO(l),1===d.readonly&&$("#btnExport").hide(),0===d.readonly&&$("#btnExport").show(),$("#btnExportPng").show(),null!=c?c.reload(d.voxels,d.x,d.y,d.z,!0,!1):c=new Editor(d);break}if("b"===g)return void $.getJSON("static/Trove.json",function(a){var b;if(b=a[l.toLowerCase()],null==b)return $("#WebGlContainer").empty(),c=null;d=new Base64IO(b),$("#btnExport").hide(),$("#btnExportPng").show(),null!=c?c.reload(d.voxels,d.x,d.y,d.z,!0,!1):c=new Editor(d);try{return history.replaceState({voxels:d.voxels,x:d.x,y:d.y,z:d.z,readonly:!0},"Troxel","#b="+l.toLowerCase())}catch(a){}})}return null==d?($("#WebGlContainer").empty(),c=null):void 0},window.onpopstate(),$('input[type="file"]').change(function(){var a,c,d,e;if($(this).prop("files").length>1){for(b=$(this).prop("files"),$("#filetabs li:last a").tab("show"),$("#tabdrag ul").empty(),e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push($("#tabdrag ul").append($("<li>"+a.name+"</li>")));return e}}),document.addEventListener("dragover",function(a){return a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}),document.addEventListener("drop",function(a){var c,d,e,f;if(a.stopPropagation(),a.preventDefault(),b=a.dataTransfer.files,b.length>0){for($("#openModal").modal("show"),$("#dragTab").click(),$("#tabdrag ul").empty(),f=[],d=0,e=b.length;e>d;d++)c=b[d],f.push($("#tabdrag ul").append($("<li>"+c.name+"</li>")));return f}}),$("#open").click(function(){var a,e,f,g,h,i,j,k,l,m,n,o,p,q;switch(g=function(a){var b,e,f;null!=a&&$("#ImportRestorAP").prop("checked")&&(null==m.voxels[a[2]]&&(m.voxels[a[2]]=[]),null==m.voxels[a[2]][a[1]]&&(m.voxels[a[2]][a[1]]=[]),null!=m.voxels[a[2]][a[1]][a[0]]?7!==m.voxels[a[2]][a[1]][a[0]].t&&console.warn("Skip importing AP because already existing voxel at some postion. Model most likely not exported from Trove."):m.voxels[a[2]][a[1]][a[0]]={r:255,g:0,b:255,a:250,t:7,s:7}),null!=d&&$("#ImportMerge").prop("checked")?(f={x:parseInt($("#QbMergeOffX").val()),y:parseInt($("#QbMergeOffY").val()),z:parseInt($("#QbMergeOffZ").val())},d.merge(m,f,$("#ImportAPrelativeOffsets").prop("checked"))):d=m,$("#openModal").modal("hide"),$("#modeEdit").parent().hasClass("active")&&$("#modeView").click(),null==d.readonly||0===d.readonly?$("#btnExport").show():$("#btnExport").hide(),$("#btnExportPng").show(),null!=c?c.reload(d.voxels,d.x,d.y,d.z,!0,!1):c=new Editor(d),e={voxels:d.voxels,x:d.x,y:d.y,z:d.z},b=new Base64IO(e).export(!1);try{return history.pushState(e,"Troxel","#m="+b)}catch(a){return history.pushState(null,"Troxel","#m="+b)}},console.log("##################################################"),$("#filetabs li.active a").attr("href")){case"#tabdrag":if("zox"===b[0].name.split(".").pop())m=new ZoxelIO(b[0],g);else if("vox"===b[0].name.split(".").pop())m=new MagicaIO(b[0],g);else if("qb"===b[0].name.split(".").pop()){for(i={},j=k=0,l=b.length;l>k;j=++k)switch(h=b[j],h.name.substr(-5)){case"_a.qb":null==i.a&&(i.a=h);break;case"_t.qb":null==i.t&&(i.t=h);break;case"_s.qb":null==i.s&&(i.s=h);break;default:".qb"===h.name.substr(-3)&&(i.m=h)}null!=i.m?m=new QubicleIO(i,g):alert("Can't find Qubicle main mesh file!")}else alert("Can't import selected file format.");break;case"#tabqb":h=$("#fqb").prop("files")[0],h&&"qb"===h.name.split(".").pop()?m=new QubicleIO({m:h,a:h=$("#fqba").prop("files")[0],t:h=$("#fqbt").prop("files")[0],s:h=$("#fqbs").prop("files")[0]},g):alert("Please choose at least a valid main mesh Qubicle (.qb) file above!");break;case"#tabvox":h=$("#fvox").prop("files")[0],h&&"vox"===h.name.split(".").pop()?m=new MagicaIO(h,g):alert("Please choose a valid Magica Voxel (.vox) file above!");break;case"#tabzox":h=$("#fzox").prop("files")[0],h&&"zox"===h.name.split(".").pop()?m=new ZoxelIO(h,g):alert("Please choose a valid Zoxel (.zox) file above!");break;case"#tabjson":m=new JsonIO($("#sjson").val()),g();break;case"#tabtrove":$.getJSON("static/Trove.json",function(a){var b,e,f;if(e=a[$("#sbtrove").val().toLowerCase()],null!=e){null!=d&&$("#ImportMerge").prop("checked")?(f={x:parseInt($("#QbMergeOffX").val()),y:parseInt($("#QbMergeOffY").val()),z:parseInt($("#QbMergeOffZ").val())},d.merge(new Base64IO(e),f,$("#ImportAPrelativeOffsets").prop("checked")),b="#m="+new Base64IO(d).export(!0,2)):(d=new Base64IO(e),b="#b="+$("#sbtrove").val().toLowerCase()),$("#openModal").modal("hide"),$("#modeEdit").parent().hasClass("active")&&$("#modeView").click(),$("#btnExport").hide(),$("#btnExportPng").show(),null!=c?c.reload(d.voxels,d.x,d.y,d.z,!0,!1):c=new Editor(d);try{return history.pushState({voxels:d.voxels,x:d.x,y:d.y,z:d.z,readonly:!0},"Troxel",b)}catch(a){return history.pushState(null,"Troxel",b)}}});break;case"#tabnew":o=parseInt($("#snewX").val()),p=parseInt($("#snewY").val()),q=parseInt($("#snewZ").val()),n=[],$("#cbnewAp").prop("checked")&&(a=parseInt($("#snewApX").val()),e=parseInt($("#snewApY").val()),f=parseInt($("#snewApZ").val()),o>a&&p>e&&q>f&&(n[f]=[],n[f][e]=[],n[f][e][a]={r:255,g:0,b:255,a:250,t:7,s:7})),m=new IO({x:o,y:p,z:q,voxels:n}),g(),$("#modeEdit").click()}}),$("#openTroveTab").click(function(){var a,b;return b=0,a=new Bloodhound({datumTokenizer:function(a){return a.value.split(/[\[,\],_]/i)},queryTokenizer:function(a){return a.split(/[\s,_]/i)},limit:1e4,prefetch:{url:"static/Trove.json",cacheKey:"TroveBlueprintCache",filter:function(a){return $.map(a,function(a,b){return{value:b}})}}}),a.initialize(),$("#sbtrove").typeahead({highlight:!0,minLength:2,hint:!1},{name:"troveBlueprints",source:a.ttAdapter()})}),$(".snewApPos").prop("disabled",!0),$("#cbnewAp").prop("checked",!1).change(function(){return $(".snewApPos").prop("disabled",!$(this).prop("checked"))}),$("#btnExport").click(function(){return $("#exportQb").text("Export as Qubicle (.qb) ...").removeAttr("href"),$("#exportQba").hide().removeAttr("href"),$("#exportQbt").hide().removeAttr("href"),$("#exportQbs").hide().removeAttr("href"),$("#exportZox").text("Export as Zoxel (.zox) ...").removeAttr("href"),$("#exportVox").text("Export as Magica Voxel (.vox) ...").removeAttr("href"),$("#exportBase64Ta").hide(),$("#exportJsonTa").hide()}),$("#exportQb").click(function(){var a,b,c,e,f,g;if(!d.readonly)return null==$(this).attr("href")?(g=new QubicleIO(d).export($("#exportQbComp").prop("checked")),b=g[0],c=g[1],f=g[2],e=g[3],a=$("#exportFilenameQb").val()||"Model",$(this).text("Download main mash (.qb)").attr("download",a+".qb").attr("href",b),$("#exportQba").show().attr("download",a+"_a.qb").attr("href",c),$("#exportQbt").show().attr("download",a+"_t.qb").attr("href",f),$("#exportQbs").show().attr("download",a+"_s.qb").attr("href",e)):void 0}),$("#exportZox").click(function(){var a;if(!d.readonly)return a=$("#exportFilenameZox").val()||"Model",null==$(this).attr("href")?$(this).text("Download as Zoxel (.zox)").attr("download",a+".zox").attr("href",new ZoxelIO(d).export()):void 0}),$("#exportVox").click(function(){var a;if(!d.readonly)return a=$("#exportFilenameVox").val()||"Model",null==$(this).attr("href")?$(this).text("Download as Magica Voxel (.vox)").attr("download",a+".vox").attr("href",new MagicaIO(d).export()):void 0}),$("#exportBase64").click(function(){var a,b,c,e,f,g,h,i;if(!d.readonly)return $("#exportBase64Rbb").prop("checked")&&(f=d.computeBoundingBox(),g=f[0],h=f[1],i=f[2],b=f[3],c=f[4],e=f[5],d.resize(g,h,i,b,c,e)),a=window.location.toString().split("#")[0]+"#m="+new Base64IO(d).export($("#exportBase64Ro").prop("checked"),$("#exportBase64V2").prop("checked")?2:1),$("#exportBase64Ta").val(a).fadeIn(),$("#exportBase64Tsl").prop("checked")?$.post("https://trovesaurus.com/shorturl.php",{TroxelData:a}).done(function(a){return $("#exportBase64Ta").val(a)}):void 0}),$("#exportJson").click(function(){return d.readonly?void 0:$("#exportJsonTa").val(new JsonIO(d).export($("#exportJsonPret").prop("checked"))).fadeIn()}),$("#btnExportPng").click(function(){return c.render(!0)}),$("#ulSavedModels").parent().on("show.bs.dropdown",function(a){var b,e,f,g;if("#ulSavedModels"===$(a.relatedTarget).data("tag")){for(null==d||1===d.readonly?$(this).find("a[data-target=#saveModal]").prop("disabled",!0).parent().addClass("disabled"):$(this).find("a[data-target=#saveModal]").prop("disabled",!1).parent().removeClass("disabled"),$("#ulSavedModels li:gt(6)").remove(),b=e=0,g=window.localStorage.length;g>e;b=e+=1)f=window.localStorage.key(b),0!==f.indexOf("__")&&$("#ulSavedModels").append("<li><a class='openSavedModel' data-model='"+window.localStorage.getItem(f)+"'>"+f+"</a></li>");0===$(".openSavedModel").length&&$("#ulSavedModels").append('<li class="disabled"><a>No saved models</a></li>')}return $(".openSavedModel").click(function(){d=new Base64IO($(this).data("model")),(null==d.readonly||0===d.readonly)&&$("#btnExport").show(),$("#btnExportPng").show();try{history.pushState({voxels:this.voxels,x:this.x,y:this.y,z:this.z},"Troxel","#m="+$(this).data("model"))}catch(a){history.pushState(null,"Troxel","#m="+$(this).data("model"))}return null!=c?c.reload(d.voxels,d.x,d.y,d.z,!0,!1):c=new Editor(d),$("#ulSavedModels li:eq(1) a").text($(this).text())})}),$("#saveModelAs").click(function(){return 0===$("#saveModelName").val().length||null==d||d.readonly?void 0:(window.localStorage.setItem($("#saveModelName").val(),new Base64IO(d).export(d.readonly)),$("#saveModal").modal("hide"))}),$("#modeView").click(function(){return null==d||$(this).parent().hasClass("active")?void 0:($(this).parent().addClass("active"),$("#modeEdit").parent().removeClass("active"),c.changeEditMode(!1),$("#addPanel").fadeOut(),"undefined"!=typeof ga&&null!==ga?ga("send","pageview","/"):void 0)}),$("#modeEdit").click(function(){return null==d||d.readonly||$(this).parent().hasClass("active")?void 0:($(this).parent().addClass("active"),$("#modeView").parent().removeClass("active"),c.changeEditMode(!0),$("#addPanel").fadeIn(),"undefined"!=typeof ga&&null!==ga?ga("send","pageview","/Troxel/edit"):void 0)}),$(".rotateBtn").click(function(){var a,b;if(null!=d){switch($(this).data("rotate")){case"x":d.rotateX(!0);break;case"-x":d.rotateX(!1);break;case"y":d.rotateY(!0);break;case"-y":d.rotateY(!1);break;case"z":d.rotateZ(!0);break;case"-z":d.rotateZ(!1)}c.reload(d.voxels,d.x,d.y,d.z,!0,!1),b={voxels:d.voxels,x:d.x,y:d.y,z:d.z,readonly:d.readonly},a=new Base64IO(b).export(!1);try{return history.pushState(b,"Troxel","#m="+a)}catch(b){return history.pushState(null,"Troxel","#m="+a)}}}),$(".moveBtn").click(function(){var a,b;if(null!=d){switch($(this).data("move")){case"x":d.moveX(!0,!0);break;case"-x":d.moveX(!1,!0);break;case"y":d.moveY(!0,!0);break;case"-y":d.moveY(!1,!0);break;case"z":d.moveZ(!0,!0);break;case"-z":d.moveZ(!1,!0)}c.reload(d.voxels,d.x,d.y,d.z,!1,!1),b={voxels:d.voxels,x:d.x,y:d.y,z:d.z,readonly:d.readonly},a=new Base64IO(b).export(!1);try{return history.pushState(b,"Troxel","#m="+a)}catch(b){return history.pushState(null,"Troxel","#m="+a)}}}),$(".mirrorBtn").click(function(){var a,b;if(null!=d){switch($(this).data("mirror")){case"x":d.mirrorX(!0);break;case"y":d.mirrorY(!0);break;case"z":d.mirrorZ(!0)}c.reload(d.voxels,d.x,d.y,d.z,!1,!1),b={voxels:d.voxels,x:d.x,y:d.y,z:d.z,readonly:d.readonly},a=new Base64IO(b).export(!1);try{return history.pushState(b,"Troxel","#m="+a)}catch(b){return history.pushState(null,"Troxel","#m="+a)}}}),$(".panel-heading").click(function(){var a;return a=$(this).find("button span"),a.hasClass("glyphicon-minus")?a.removeClass("glyphicon-minus").addClass("glyphicon-plus"):a.removeClass("glyphicon-plus").addClass("glyphicon-minus"),$(this).next().toggle()}),$("#backgroundColor").val("#888888").change(function(){return null!=c?(c.renderer.setClearColor(new THREE.Color($(this).val()).getHex()),c.controls.needsRender=!0,$("body").css("background-color",$(this).val())):void 0}),$("#ambLightColor").val("#606060").change(function(){return null!=c?(c.ambientLight.color=new THREE.Color($(this).val()),c.controls.needsRender=!0):void 0}),$("#dirLightColor").val("#ffffff").change(function(){return null!=c?(c.directionalLight.color=new THREE.Color($(this).val()),c.controls.needsRender=!0):void 0}),$("#dirLightIntensity").val(.3).change(function(){return null!=c?(c.directionalLight.intensity=parseFloat($(this).val()),c.controls.needsRender=!0):void 0}),$("#pointLightColor").val("#ffffff").change(function(){return null!=c?(c.pointLight.color=new THREE.Color($(this).val()),c.controls.needsRender=!0):void 0}),$("#pointLightIntensity").val(.7).change(function(){return null!=c?(c.pointLight.intensity=parseFloat($(this).val()),c.controls.needsRender=!0):void 0}),$("#dirLightX").val("-0.5"),$("#dirLightY").val("-0.5"),$("#dirLightZ").val("1"),$("#dirLightVector").click(function(){return null!=c?(c.directionalLight.position.set(parseFloat($("#dirLightX").val()),parseFloat($("#dirLightY").val()),parseFloat($("#dirLightZ").val())).normalize(),c.controls.needsRender=!0):void 0}),$("#addVoxAP").click(function(){return $("#addVoxColor").val("#ff00ff"),$("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!0)}),$("#addVoxColor").change(function(){switch($(this).val()){case"#ff00ff":return $("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!0);default:return $("#addVoxAlpha, #addVoxType, #addVoxSpecular").prop("disabled",!1),$("#addVoxType").change()}}),$("#addVoxType").change(function(){switch(parseInt($(this).val())){case 1:case 2:case 4:return $("#addVoxAlpha").prop("disabled",!1),$("#addVoxSpecular").prop("disabled",!0);case 0:case 3:return $("#addVoxAlpha").prop("disabled",!0),$("#addVoxSpecular").prop("disabled",!1)}}),$("#addVoxAlpha").val(112),$("#editVoxNoiseBright").val(0),$("#editVoxNoiseHSL").val(0),$("#resizeModal").on("shown.bs.modal",function(){return null==c?$("#resizeModal").modal("hide"):void 0}),$("#openResizeModal").click(function(){return null!=c?($("#resizeX").val(d.x),$("#resizeY").val(d.y),$("#resizeZ").val(d.z),$("#resizeOffX").val(0),$("#resizeOffY").val(0),$("#resizeOffZ").val(0)):void 0}),$("#resizeBtn").click(function(){var a,b;if(null!=c){$("#resizeModal").modal("hide"),d.resize(parseInt($("#resizeX").val()),parseInt($("#resizeY").val()),parseInt($("#resizeZ").val()),parseInt($("#resizeOffX").val()),parseInt($("#resizeOffY").val()),parseInt($("#resizeOffZ").val())),c.reload(d.voxels,d.x,d.y,d.z,!0,!1),b={voxels:d.voxels,x:d.x,y:d.y,z:d.z,readonly:d.readonly},a=new Base64IO(b).export(!1);try{return history.pushState(b,"Troxel","#m="+a)}catch(b){return history.pushState(null,"Troxel","#m="+a)}}}),$("#resizeCalcBBb").click(function(){var a,b,e,f,g,h,i;if(null!=c)return f=d.computeBoundingBox(),g=f[0],h=f[1],i=f[2],a=f[3],b=f[4],e=f[5],$("#resizeX").val(g),$("#resizeY").val(h),$("#resizeZ").val(i),$("#resizeOffX").val(a),$("#resizeOffY").val(b),$("#resizeOffZ").val(e)}),$($(".editTool")[0]).parent().button("toggle"),$("#fillSameColor").prop("checked",!0),$(".editTool").change(function(){switch($(this).data("edittool")){case 1:return $("#fillSameColorDiv").show();default:return $("#fillSameColorDiv").hide()}}),$('[data-toggle="tooltip"]').tooltip(),$("#rendererPostEffect").val(1).change(function(){return null!=c?c=new Editor(d):void 0}),$("#renderMode").change(function(){return null!=c?(c.renderMode=parseInt($(this).val()),c.reload(d.voxels,d.x,d.y,d.z,!1,!1)):void 0}),$("#renderWireframes").change(function(){return null!=c?(c.renderWireframes=parseInt($(this).val()),c.reload(d.voxels,d.x,d.y,d.z,!1,!1)):void 0}),$("#renderControls").change(function(){return null!=c?c.controls.mode="0"===$(this).val():void 0}),$("#ImportMerge").prop("checked",!1).change(function(){return $(".QbMergeOff").prop("disabled",!$(this).prop("checked"))}),$("#renderAutoRotateSpeed").val(0).change(function(){var a;if(null!=c)return a=parseInt($(this).val()),0===a?c.controls.autoRotate=!1:(c.controls.autoRotate=!0,c.controls.autoRotateSpeed=a)}),$("#TroveCreationsLint").click(function(){var a,b,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(null!=c){$("#TroveCreationsExportLink").hide(),d.readonly?$("#TroveCreationsExportDiv").hide():$("#TroveCreationsExportDiv").show(),v=$("#TroveCreationsType").val(),t=new TroveCreationsLint(d,v),c.renderWireframes=6,$("#renderWireframes").val("6"),c.reload(d.voxels,d.x,d.y,d.z,!0,!1),g={voxels:d.voxels,x:d.x,y:d.y,z:d.z,readonly:d.readonly},a=new Base64IO(g).export(!1);try{history.pushState(g,"Troxel","#m="+a)}catch(b){history.pushState(null,"Troxel","#m="+a)}for($("#TroveCreationsLintingResults").empty(),n=t.errors,h=0,j=n.length;j>h;h++)b=n[h],e=null!=b.footer?'<hr style="margin-top: 5px; margin-bottom: 5px;"><p><b>Hot to fix it?: </b><i>'+b.footer+"</i></p>":"",$("#TroveCreationsLintingResults").append('<div class="alert alert-danger"><h4>'+b.title+"</h4>"+b.body+e+"</div>");for((null!=(o=d.warn)?o.length:void 0)>0&&$("#TroveCreationsLintingResults").append('<div class="alert alert-warning"><h4>Troxel had to fix issues in your material maps for you!</h4> There were issues in your material maps like invalid color values in the type / alpha / specular map or having a voxel in one map but not in another. These were fixed automatically on import by Troxel for you. It\'s recommended that you either fix these isues by yourself in your source .qb files or use the .qb files exported by Troxel for creating your .blueprint for submission. <textarea class="form-control" style="resize: none">'+d.warn.join("\n")+"</textarea></div>"),p=t.warnings,i=0,k=p.length;k>i;i++)w=p[i],e=null!=w.footer?'<hr style="margin-top: 5px; margin-bottom: 5px;"><p><b>Hot to fix it?: </b><i>'+w.footer+"</i></p>":"",$("#TroveCreationsLintingResults").append('<div class="alert alert-warning"><h4>'+w.title+"</h4>"+w.body+e+"</div>");for(q=t.infos,m=0,l=q.length;l>m;m++)f=q[m],$("#TroveCreationsLintingResults").append('<div class="alert alert-info"><h4>'+f.title+"</h4>"+f.body+"</div>");return t.warnings.length===(r=t.errors.length)&&0===r?$("#TroveCreationsLintingResults").append('<div class="alert alert-success"><h4>All test passed!</h4>There is nothing to complain about your model. Thats great, go submitting it!</div>'):(x=t.warnings.length+((null!=(s=d.warn)?s.length:void 0)>0?1:0),$("#TroveCreationsLintingCount").text("Warning: You have "+t.errors.length+" errors and "+x+" warnings for your voxel model. Please try to fix them for submitting it to the Trove Creation Reddit!")),u=function(){switch(v){case"melee":return'melee weapon creation check out the <a href="http://trove.wikia.com/wiki/Melee_weapon_creation" class="alert-link" target="_blank">melee weapon creation guide</a>';case"gun":return'gun creation check out the <a href="http://trove.wikia.com/wiki/Gun_Weapon_Creation" class="alert-link" target="_blank">gun creation guide</a>';case"staff":return'staff creation check out the <a href="http://trove.wikia.com/wiki/Staff_Creation_Guide" class="alert-link" target="_blank">staff creation guide</a>';case"bow":return'bow creation check out the <a href="http://trove.wikia.com/wiki/Bow_Creation_Guide" class="alert-link" target="_blank">bow creation guide</a>';case"spear":return'spear creation check out the <a href="http://trove.wikia.com/wiki/Spear_Creation_Guide" class="alert-link" target="_blank">spear creation guide</a>';case"mask":return'mask creation check out the <a href="http://trove.wikia.com/wiki/Mask_creation" class="alert-link" target="_blank">mask creation guide</a>';case"hat":return'hat creation check out the <a href="http://trove.wikia.com/wiki/Hat_creation" class="alert-link" target="_blank">hat creation guide</a>';case"hair":return'hair creation check out the <a href="http://trove.wikia.com/wiki/Hair_creation" class="alert-link" target="_blank">hair creation guide</a>';case"deco":return'decoration creation check out the <a href="http://trove.wikia.com/wiki/Cornerstone_decoration_creation" class="alert-link" target="_blank">decoration creation guide</a>';case"lair":case"dungeon":return'lair and dungeon creation check out the <a href="http://trove.wikia.com/wiki/Lair_and_Dungeon_creation" class="alert-link" target="_blank">lair and dungeon creation guide</a>';default:return'Trove creations check out the <a href="http://trove.wikia.com/wiki/Guides" class="alert-link" target="_blank">trove creations guides</a>'}}(),$("#TroveCreationsLintingResults").prepend('<div class="alert alert-info">For more information about '+u+'. Also check out the <a href="http://trove.wikia.com/wiki/Material_Map_Guide" class="alert-link" target="_blank">Material Maps Guide</a>, the <a href="http://trove.wikia.com/wiki/Style_guidelines" class="alert-link" target="_blank">offical Style Guidelines</a> and the <a href="http://trove.wikia.com/wiki/Mods\'_Style_Guidelines" class="alert-link" target="_blank"> Mods\' Style Guidelines</a>! Note: You will also need some ingame screenshots for your item submission.</div>')}}),$("#TroveCreationsExport").click(function(){var a;if(!d.readonly)return a=window.location.toString().split("#")[0]+"#m="+new Base64IO(d).export($("#TroveCreationsReadonly").prop("checked"),2),$("#TroveCreationsExportLink").val("[Troxel Link]("+a+")").fadeIn(),$("#TroveCreationsTsl").prop("checked")?$.post("https://trovesaurus.com/shorturl.php",{TroxelData:a}).done(function(a){return $("#TroveCreationsExportLink").val(a)}):void 0}),$("#TroveCreationLinterModal").on("shown.bs.modal",function(){return null==c?$("#TroveCreationLinterModal").modal("hide"):void 0})}.call(this);
